SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_Cart] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Cart] -- Replaced column type [ntext] with [nvarchar](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_Cart](
	[CartGuid] [uniqueidentifier] NOT NULL,
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[UserGuid] [uniqueidentifier] NOT NULL,
	[SubTotal] [decimal](15, 4) NOT NULL,
	[TaxTotal] [decimal](15, 4) NOT NULL,
	[ShippingTotal] [decimal](15, 4) NOT NULL,
	[OrderTotal] [decimal](15, 4) NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NULL,
	[LastModified] [datetime] NULL,
	[LastUserActivity] [datetime] NULL,
	[CustomData] [nvarchar](max) NULL,
	[DiscountCodesCsv] [nvarchar](max) NULL,
	[Discount] [decimal](15, 4) NULL,
	[ClerkGuid] [uniqueidentifier] NULL,
 CONSTRAINT [PK_ws_Cart_1] PRIMARY KEY CLUSTERED 
(
	[CartGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
--~ Table [dbo].[ws_Cart] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Cart] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart]') AND name = N'idxCartIP')
CREATE NONCLUSTERED INDEX [idxCartIP] ON [dbo].[ws_Cart] 
(
	[CreatedFromIP] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Cart] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Cart] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart]') AND name = N'idxCartSGuid')
CREATE NONCLUSTERED INDEX [idxCartSGuid] ON [dbo].[ws_Cart] 
(
	[StoreGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Cart] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Cart] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart]') AND name = N'idxCartUGuid')
CREATE NONCLUSTERED INDEX [idxCartUGuid] ON [dbo].[ws_Cart] 
(
	[UserGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Cart] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Cart] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart]') AND name = N'IX_wsCartClerk')
CREATE NONCLUSTERED INDEX [IX_wsCartClerk] ON [dbo].[ws_Cart] 
(
	[ClerkGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_CartOffers] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_CartOffers](
	[ItemGuid] [uniqueidentifier] NOT NULL,
	[CartGuid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[TaxClassGuid] [uniqueidentifier] NULL,
	[OfferPrice] [decimal](15, 4) NOT NULL,
	[AddedToCart] [datetime] NOT NULL,
	[Quantity] [int] NOT NULL,
	[Tax] [decimal](15, 4) NOT NULL,
	[IsDonation] [bit] NULL,
 CONSTRAINT [PK_ws_CartOfferItems] PRIMARY KEY CLUSTERED 
(
	[ItemGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_CartOrderInfo] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOrderInfo]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_CartOrderInfo](
	[CartGuid] [uniqueidentifier] NOT NULL,
	[CustomerName] [nvarchar](255) NULL,
	[CustomerCompany] [nvarchar](255) NULL,
	[CustomerAddressLine1] [nvarchar](255) NULL,
	[CustomerAddressLine2] [nvarchar](255) NULL,
	[CustomerSuburb] [nvarchar](255) NULL,
	[CustomerCity] [nvarchar](255) NULL,
	[CustomerPostalCode] [nvarchar](20) NULL,
	[CustomerState] [nvarchar](255) NULL,
	[CustomerCountry] [nvarchar](255) NULL,
	[CustomerTelephoneDay] [nvarchar](32) NULL,
	[CustomerTelephoneNight] [nvarchar](32) NULL,
	[CustomerEmail] [nvarchar](96) NULL,
	[CustomerEmailVerified] [bit] NOT NULL,
	[DeliveryName] [nvarchar](255) NULL,
	[DeliveryCompany] [nvarchar](255) NULL,
	[DeliveryAddress1] [nvarchar](255) NULL,
	[DeliveryAddress2] [nvarchar](255) NULL,
	[DeliverySuburb] [nvarchar](255) NULL,
	[DeliveryCity] [nvarchar](255) NULL,
	[DeliveryPostalCode] [nvarchar](20) NULL,
	[DeliveryState] [nvarchar](255) NULL,
	[DeliveryCountry] [nvarchar](255) NULL,
	[BillingName] [nvarchar](255) NULL,
	[BillingCompany] [nvarchar](255) NULL,
	[BillingAddress1] [nvarchar](255) NULL,
	[BillingAddress2] [nvarchar](255) NULL,
	[BillingSuburb] [nvarchar](255) NULL,
	[BillingCity] [nvarchar](255) NULL,
	[BillingPostalCode] [nvarchar](20) NULL,
	[BillingState] [nvarchar](255) NULL,
	[BillingCountry] [nvarchar](255) NULL,
	[CardTypeGuid] [uniqueidentifier] NOT NULL,
	[CardOwner] [nvarchar](100) NULL,
	[CardNumber] [nvarchar](255) NULL,
	[CardExpires] [nvarchar](6) NULL,
	[CardSecurityCode] [nvarchar](50) NULL,
	[Completed] [datetime] NULL,
	[CompletedFromIP] [nvarchar](255) NULL,
	[TaxZoneGuid] [uniqueidentifier] NULL,
	[CustomerFirstName] [nvarchar](100) NULL,
	[CustomerLastName] [nvarchar](100) NULL,
	[DeliveryFirstName] [nvarchar](100) NULL,
	[DeliveryLastName] [nvarchar](100) NULL,
	[BillingFirstName] [nvarchar](100) NULL,
	[BillingLastName] [nvarchar](100) NULL,
 CONSTRAINT [PK_ws_Cart] PRIMARY KEY CLUSTERED 
(
	[CartGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_Discount] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_Discount](
	[DiscountGuid] [uniqueidentifier] NOT NULL,
	[DiscountCode] [nvarchar](255) NOT NULL,
	[Description] [nvarchar](255) NOT NULL,
	[SiteGuid] [uniqueidentifier] NOT NULL,
	[ModuleGuid] [uniqueidentifier] NOT NULL,
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[ValidityStartDate] [datetime] NOT NULL,
	[ValidityEndDate] [datetime] NULL,
	[UseCount] [int] NOT NULL,
	[MaxCount] [int] NOT NULL,
	[MinOrderAmount] [decimal](15, 4) NOT NULL,
	[AbsoluteDiscount] [decimal](15, 4) NOT NULL,
	[PercentageDiscount] [decimal](15, 4) NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedUtc] [datetime] NOT NULL,
	[LastModBy] [uniqueidentifier] NOT NULL,
	[LastModUtc] [datetime] NOT NULL,
	[AllowOtherDiscounts] [bit] NULL,
 CONSTRAINT [PK_ws_Discount] PRIMARY KEY NONCLUSTERED 
(
	[DiscountGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
--~ Table [dbo].[ws_Discount] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Discount] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount]') AND name = N'IX_ws_Discount')
CREATE UNIQUE CLUSTERED INDEX [IX_ws_Discount] ON [dbo].[ws_Discount] 
(
	[ModuleGuid] ASC,
	[DiscountCode] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Discount] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Discount] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount]') AND name = N'IX_ws_Discount_1')
CREATE NONCLUSTERED INDEX [IX_ws_Discount_1] ON [dbo].[ws_Discount] 
(
	[SiteGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Discount] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Discount] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount]') AND name = N'IX_ws_Discount_2')
CREATE NONCLUSTERED INDEX [IX_ws_Discount_2] ON [dbo].[ws_Discount] 
(
	[ModuleGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Discount] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Discount] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount]') AND name = N'IX_ws_Discount_3')
CREATE NONCLUSTERED INDEX [IX_ws_Discount_3] ON [dbo].[ws_Discount] 
(
	[OfferGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Discount] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Discount] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount]') AND name = N'IX_ws_Discount_4')
CREATE NONCLUSTERED INDEX [IX_ws_Discount_4] ON [dbo].[ws_Discount] 
(
	[Description] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_FullfillDownloadHistory] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadHistory]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_FullfillDownloadHistory](
	[Guid] [uniqueidentifier] NOT NULL,
	[TicketGuid] [uniqueidentifier] NOT NULL,
	[UTCTimestamp] [datetime] NOT NULL,
	[IPAddress] [nvarchar](255) NOT NULL,
 CONSTRAINT [PK_ws_FullfillDownloadHistory] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_FullfillDownloadTerms] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_FullfillDownloadTerms] -- Replaced column type [ntext] with [nvarchar](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_FullfillDownloadTerms](
	[Guid] [uniqueidentifier] NOT NULL,
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[DownloadsAllowed] [int] NOT NULL,
	[ExpireAfterDays] [int] NOT NULL,
	[CountAfterDownload] [bit] NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NULL,
	[LastModified] [datetime] NULL,
	[LastModifedBy] [uniqueidentifier] NULL,
	[LastModifedFromIPAddress] [nvarchar](255) NULL,
	[Name] [nvarchar](255) NULL,
	[Description] [nvarchar](max) NULL,
 CONSTRAINT [PK_ws_FullfillmentDownloadTerms] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_FullfillDownloadTicket] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_FullfillDownloadTicket](
	[Guid] [uniqueidentifier] NOT NULL,
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[OrderGuid] [uniqueidentifier] NOT NULL,
	[UserGuid] [uniqueidentifier] NOT NULL,
	[ProductGuid] [uniqueidentifier] NOT NULL,
	[FullfillTermsGuid] [uniqueidentifier] NOT NULL,
	[DownloadsAllowed] [int] NOT NULL,
	[ExpireAfterDays] [int] NOT NULL,
	[CountAfterDownload] [bit] NOT NULL,
	[PurchaseTime] [datetime] NOT NULL,
	[DownloadedCount] [int] NOT NULL,
 CONSTRAINT [PK_ws_FullfillDownloadTicket] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_Offer] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Offer] -- Replaced column type [ntext] with [nvarchar](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_Offer](
	[Guid] [uniqueidentifier] NOT NULL,
	[StoreGuid] [uniqueidentifier] NULL,
	[IsVisible] [bit] NOT NULL,
	[IsSpecial] [bit] NOT NULL,
	[TaxClassGuid] [uniqueidentifier] NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NOT NULL,
	[IsDeleted] [bit] NOT NULL,
	[DeletedTime] [datetime] NULL,
	[DeletedBy] [uniqueidentifier] NULL,
	[DeletedFromIP] [nvarchar](255) NULL,
	[LastModified] [datetime] NULL,
	[LastModifiedBy] [uniqueidentifier] NULL,
	[LastModifiedFromIP] [nvarchar](255) NULL,
	[Url] [nvarchar](255) NULL,
	[IsDonation] [bit] NULL,
	[Name] [nvarchar](255) NULL,
	[Description] [nvarchar](max) NULL,
	[Abstract] [nvarchar](max) NULL,
	[Price] [decimal](15, 4) NULL,
	[ShowDetailLink] [bit] NULL,
	[ProductListName] [nvarchar](255) NULL,
	[MetaKeywords] [nvarchar](255) NULL,
	[MetaDescription] [nvarchar](255) NULL,
	[UserCanSetPrice] [bit] NULL,
	[MaxPerOrder] [int] NULL,
	[SortRank1] [int] NULL,
	[SortRank2] [int] NULL,
 CONSTRAINT [PK_ws_Offer] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_OfferAvailability] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_OfferAvailability](
	[Guid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[BeginUTC] [datetime] NOT NULL,
	[EndUTC] [datetime] NOT NULL,
	[RequiresOfferCode] [bit] NOT NULL,
	[OfferCode] [nvarchar](50) NOT NULL,
	[MaxAllowedPerCustomer] [int] NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NOT NULL,
	[IsDeleted] [bit] NOT NULL,
	[DeletedBy] [uniqueidentifier] NULL,
	[DeletedTime] [datetime] NULL,
	[DeletedFromIP] [nvarchar](255) NULL,
	[LastModified] [datetime] NULL,
	[LastModifedBy] [uniqueidentifier] NULL,
	[LastModifedFromIP] [nvarchar](255) NULL,
 CONSTRAINT [PK_ws_OfferDateRange] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_OfferAvailabilityHistory] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailabilityHistory]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_OfferAvailabilityHistory](
	[Guid] [uniqueidentifier] NOT NULL,
	[AvailabilityGuid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[BeginUTC] [datetime] NOT NULL,
	[EndUTC] [datetime] NOT NULL,
	[RequiresOfferCode] [bit] NOT NULL,
	[OfferCode] [nvarchar](50) NOT NULL,
	[MaxAllowedPerCustomer] [int] NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NOT NULL,
	[IsDeleted] [bit] NOT NULL,
	[DeletedBy] [uniqueidentifier] NULL,
	[DeletedTime] [datetime] NULL,
	[DeletedFromIP] [nvarchar](255) NULL,
	[LastModified] [datetime] NULL,
	[LastModifedBy] [uniqueidentifier] NULL,
	[LastModifedFromIP] [nvarchar](255) NULL,
	[LogTime] [datetime] NOT NULL,
 CONSTRAINT [PK_ws_OfferAvailibilityHistory] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_OfferHistory] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferHistory]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_OfferHistory](
	[Guid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NULL,
	[StoreGuid] [uniqueidentifier] NULL,
	[TaxClassGuid] [uniqueidentifier] NULL,
	[IsVisible] [bit] NOT NULL,
	[IsSpecial] [bit] NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NOT NULL,
	[IsDeleted] [bit] NOT NULL,
	[DeletedTime] [datetime] NULL,
	[DeletedBy] [uniqueidentifier] NULL,
	[DeletedFromIP] [nvarchar](255) NULL,
	[LastModified] [datetime] NULL,
	[LastModifiedBy] [uniqueidentifier] NULL,
	[LastModifiedFromIP] [nvarchar](255) NULL,
	[LogTime] [datetime] NOT NULL,
	[Url] [nvarchar](255) NULL,
 CONSTRAINT [PK_ws_OfferHistory] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_OfferPriceHistory] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferPriceHistory]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_OfferPriceHistory](
	[Guid] [uniqueidentifier] NOT NULL,
	[PriceGuid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[CurrencyGuid] [uniqueidentifier] NOT NULL,
	[Price] [decimal](15, 4) NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NULL,
	[LastModifed] [datetime] NULL,
	[LastModifiedBy] [uniqueidentifier] NOT NULL,
	[ModifiedFromIP] [nvarchar](255) NULL,
	[LogTime] [datetime] NOT NULL,
 CONSTRAINT [PK_ws_OfferPriceHx] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_OfferProduct] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_OfferProduct](
	[Guid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[ProductGuid] [uniqueidentifier] NOT NULL,
	[FullfillType] [tinyint] NOT NULL,
	[FullFillTermsGuid] [uniqueidentifier] NOT NULL,
	[Quantity] [int] NOT NULL,
	[SortOrder] [int] NOT NULL,
	[IsDeleted] [bit] NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NULL,
	[DeletedBy] [uniqueidentifier] NULL,
	[DeletedFromIP] [nvarchar](255) NULL,
	[DeletedTime] [datetime] NULL,
	[LastModified] [datetime] NULL,
	[LastModifiedBy] [uniqueidentifier] NULL,
	[LastModifiedFromIP] [nvarchar](255) NULL,
 CONSTRAINT [PK_ws_OfferProduct] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_Order] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Order] -- Replaced column type [ntext] with [nvarchar](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_Order](
	[OrderGuid] [uniqueidentifier] NOT NULL,
	[OrderNo] [int] IDENTITY(1,1) NOT NULL,
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[UserGuid] [uniqueidentifier] NOT NULL,
	[CustomerCompany] [nvarchar](255) NULL,
	[CustomerAddressLine1] [nvarchar](255) NULL,
	[CustomerAddressLine2] [nvarchar](255) NULL,
	[CustomerSuburb] [nvarchar](255) NULL,
	[CustomerCity] [nvarchar](255) NULL,
	[CustomerPostalCode] [nvarchar](20) NULL,
	[CustomerState] [nvarchar](255) NULL,
	[CustomerCountry] [nvarchar](255) NULL,
	[CustomerTelephoneDay] [nvarchar](32) NULL,
	[CustomerTelephoneNight] [nvarchar](32) NULL,
	[CustomerEmail] [nvarchar](96) NULL,
	[CustomerEmailVerified] [bit] NOT NULL,
	[DeliveryCompany] [nvarchar](255) NULL,
	[DeliveryAddress1] [nvarchar](255) NULL,
	[DeliveryAddress2] [nvarchar](255) NULL,
	[DeliverySuburb] [nvarchar](255) NULL,
	[DeliveryCity] [nvarchar](255) NULL,
	[DeliveryPostalCode] [nvarchar](20) NULL,
	[DeliveryState] [nvarchar](255) NULL,
	[DeliveryCountry] [nvarchar](255) NULL,
	[BillingCompany] [nvarchar](255) NULL,
	[BillingAddress1] [nvarchar](255) NULL,
	[BillingAddress2] [nvarchar](255) NULL,
	[BillingSuburb] [nvarchar](255) NULL,
	[BillingCity] [nvarchar](255) NULL,
	[BillingPostalCode] [nvarchar](20) NULL,
	[BillingState] [nvarchar](255) NULL,
	[BillingCountry] [nvarchar](255) NULL,
	[CardTypeGuid] [uniqueidentifier] NOT NULL,
	[CardOwner] [nvarchar](100) NULL,
	[CardNumber] [nvarchar](255) NULL,
	[CardExpires] [nvarchar](6) NULL,
	[CardSecurityCode] [nvarchar](50) NULL,
	[SubTotal] [decimal](15, 4) NULL,
	[TaxTotal] [decimal](15, 4) NULL,
	[ShippingTotal] [decimal](15, 4) NULL,
	[OrderTotal] [decimal](15, 4) NULL,
	[Created] [datetime] NOT NULL,
	[CreatedFromIP] [nvarchar](255) NULL,
	[Completed] [datetime] NULL,
	[CompletedFromIP] [nvarchar](255) NULL,
	[LastModified] [datetime] NULL,
	[LastUserActivity] [datetime] NULL,
	[StatusGuid] [uniqueidentifier] NULL,
	[GatewayTransID] [nvarchar](255) NULL,
	[GatewayRawResponse] [nvarchar](max) NULL,
	[GatewayAuthCode] [nvarchar](50) NULL,
	[TaxZoneGuid] [uniqueidentifier] NULL,
	[CustomerFirstName] [nvarchar](100) NULL,
	[CustomerLastName] [nvarchar](100) NULL,
	[DeliveryFirstName] [nvarchar](100) NULL,
	[DeliveryLastName] [nvarchar](100) NULL,
	[BillingFirstName] [nvarchar](100) NULL,
	[BillingLastName] [nvarchar](100) NULL,
	[PaymentMethod] [nvarchar](50) NULL,
	[AnalyticsTracked] [bit] NULL,
	[CustomData] [nvarchar](max) NULL,
	[DiscountCodesCsv] [nvarchar](max) NULL,
	[Discount] [decimal](15, 4) NULL,
	[ClerkGuid] [uniqueidentifier] NULL,
 CONSTRAINT [PK_ws_CartOrder] PRIMARY KEY CLUSTERED 
(
	[OrderGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
--~ Table [dbo].[ws_Order] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Order] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order]') AND name = N'idxOrderUGuid')
CREATE NONCLUSTERED INDEX [idxOrderUGuid] ON [dbo].[ws_Order] 
(
	[UserGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
--~ Table [dbo].[ws_Order] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Order] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order]') AND name = N'IX_wsOrderClerk')
CREATE NONCLUSTERED INDEX [IX_wsOrderClerk] ON [dbo].[ws_Order] 
(
	[ClerkGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_OrderOfferProduct] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOfferProduct]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_OrderOfferProduct](
	[Guid] [uniqueidentifier] NOT NULL,
	[OrderGuid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[ProductGuid] [uniqueidentifier] NOT NULL,
	[FullfillType] [tinyint] NOT NULL,
	[FullfillTermsGuid] [uniqueidentifier] NOT NULL,
	[Created] [datetime] NOT NULL,
 CONSTRAINT [PK_ws_OrderOfferProduct] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_OrderOffers] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_OrderOffers](
	[ItemGuid] [uniqueidentifier] NOT NULL,
	[OrderGuid] [uniqueidentifier] NOT NULL,
	[OfferGuid] [uniqueidentifier] NOT NULL,
	[TaxClassGuid] [uniqueidentifier] NOT NULL,
	[OfferPrice] [decimal](15, 4) NOT NULL,
	[AddedToCart] [datetime] NOT NULL,
	[Quantity] [int] NOT NULL,
 CONSTRAINT [PK_ws_CartOrderOfferItems] PRIMARY KEY CLUSTERED 
(
	[ItemGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_Product] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Product] -- Replaced column type [ntext] with [nvarchar](max)
--~ Table [dbo].[ws_Product] -- Replaced column type [image] with [varbinary](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_Product](
	[Guid] [uniqueidentifier] NOT NULL,
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[TaxClassGuid] [uniqueidentifier] NOT NULL,
	[ModelNumber] [nvarchar](255) NULL,
	[Status] [tinyint] NOT NULL,
	[FullfillmentType] [tinyint] NOT NULL,
	[Weight] [decimal](7, 2) NOT NULL,
	[QuantityOnHand] [int] NOT NULL,
	[ImageFileName] [nvarchar](255) NULL,
	[ImageFileBytes] [varbinary](max) NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[LastModified] [datetime] NULL,
	[LastModifedBy] [uniqueidentifier] NULL,
	[IsDeleted] [bit] NOT NULL,
	[DeletedBy] [uniqueidentifier] NULL,
	[DeletedFromIP] [nvarchar](255) NULL,
	[DeletedTime] [datetime] NULL,
	[Url] [nvarchar](255) NULL,
	[Name] [nvarchar](255) NULL,
	[Description] [nvarchar](max) NULL,
	[Abstract] [nvarchar](max) NULL,
	[ShowInProductList] [bit] NULL,
	[EnableRating] [bit] NULL,
	[MetaKeywords] [nvarchar](255) NULL,
	[MetaDescription] [nvarchar](255) NULL,
	[SortRank1] [int] NULL,
	[SortRank2] [int] NULL,
	[TeaserFile] [nvarchar](255) NULL,
	[TeaserFileLink] [nvarchar](255) NULL,
 CONSTRAINT [PK_ws_Product] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_ProductFile] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_ProductFile] -- Replaced column type [image] with [varbinary](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_ProductFile]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_ProductFile](
	[ProductGuid] [uniqueidentifier] NOT NULL,
	[FileName] [nvarchar](255) NOT NULL,
	[FileImage] [varbinary](max) NULL,
	[ServerFileName] [nvarchar](255) NOT NULL,
	[ByteLength] [int] NOT NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
 CONSTRAINT [PK_ws_ProductFile] PRIMARY KEY CLUSTERED 
(
	[ProductGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_ProductHistory] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_ProductHistory] -- Replaced column type [image] with [varbinary](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_ProductHistory]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_ProductHistory](
	[Guid] [uniqueidentifier] NOT NULL,
	[ProductGuid] [uniqueidentifier] NOT NULL,
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[TaxClassGuid] [uniqueidentifier] NOT NULL,
	[Sku] [nvarchar](255) NOT NULL,
	[Status] [tinyint] NOT NULL,
	[FullfillmentType] [tinyint] NOT NULL,
	[Weight] [decimal](7, 2) NOT NULL,
	[QuantityOnHand] [int] NOT NULL,
	[ImageFileName] [nvarchar](255) NULL,
	[ImageFileBytes] [varbinary](max) NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
	[LastModified] [datetime] NULL,
	[LastModifedBy] [uniqueidentifier] NULL,
	[LogTime] [datetime] NOT NULL,
 CONSTRAINT [PK_ws_ProductHx] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_Store] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Store] -- Replaced column type [ntext] with [nvarchar](max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_Store](
	[Guid] [uniqueidentifier] NOT NULL,
	[SiteGuid] [uniqueidentifier] NOT NULL,
	[ModuleID] [int] NOT NULL,
	[Name] [nvarchar](255) NOT NULL,
	[Description] [nvarchar](max) NULL,
	[OwnerName] [nvarchar](255) NULL,
	[OwnerEmail] [nvarchar](100) NULL,
	[SalesEmail] [nvarchar](100) NOT NULL,
	[SupportEmail] [nvarchar](100) NOT NULL,
	[EmailFrom] [nvarchar](100) NULL,
	[OrderBCCEmail] [nvarchar](100) NULL,
	[Phone] [nvarchar](32) NULL,
	[Fax] [nvarchar](32) NULL,
	[Address] [nvarchar](255) NULL,
	[City] [nvarchar](255) NULL,
	[ZoneGuid] [uniqueidentifier] NOT NULL,
	[PostalCode] [nvarchar](50) NULL,
	[CountryGuid] [uniqueidentifier] NOT NULL,
	[IsClosed] [bit] NOT NULL,
	[ClosedMessage] [nvarchar](max) NULL,
	[Created] [datetime] NOT NULL,
	[CreatedBy] [uniqueidentifier] NOT NULL,
 CONSTRAINT [PK_ws_Store] PRIMARY KEY NONCLUSTERED 
(
	[Guid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
--~ Table [dbo].[ws_Store] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
--~ Table [dbo].[ws_Store] -- SORT_IN_TEMPDB removed.  It is not supported in this version of SQL Server

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store]') AND name = N'IX_ws_Store')
CREATE UNIQUE CLUSTERED INDEX [IX_ws_Store] ON [dbo].[ws_Store] 
(
	[ModuleID] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF)

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_StoreCurrency] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_StoreCurrency]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_StoreCurrency](
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[CurrencyGuid] [uniqueidentifier] NOT NULL,
	[Created] [datetime] NOT NULL,
 CONSTRAINT [PK_ws_StoreCurrency] PRIMARY KEY CLUSTERED 
(
	[StoreGuid] ASC,
	[CurrencyGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
SET QUOTED_IDENTIFIER ON

GO
--~ Table [dbo].[ws_StoreLanguage] -- PAD_INDEX removed.  It is not supported in this version of SQL Server
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_StoreLanguage]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ws_StoreLanguage](
	[StoreGuid] [uniqueidentifier] NOT NULL,
	[LanguageGuid] [uniqueidentifier] NOT NULL,
 CONSTRAINT [PK_ws_StoreLanguage] PRIMARY KEY CLUSTERED 
(
	[StoreGuid] ASC,
	[LanguageGuid] ASC
)WITH (STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF)
)
END

GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Cart_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Cart]'))
ALTER TABLE [dbo].[ws_Cart]  WITH CHECK ADD  CONSTRAINT [FK_ws_Cart_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Cart_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Cart]'))
ALTER TABLE [dbo].[ws_Cart] CHECK CONSTRAINT [FK_ws_Cart_ws_Store]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Cart_SubTotal]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Cart] ADD  CONSTRAINT [DF_ws_Cart_SubTotal]  DEFAULT ((0)) FOR [SubTotal]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Cart_TaxTotal]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Cart] ADD  CONSTRAINT [DF_ws_Cart_TaxTotal]  DEFAULT ((0)) FOR [TaxTotal]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Cart_ShippingTotal]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Cart] ADD  CONSTRAINT [DF_ws_Cart_ShippingTotal]  DEFAULT ((0)) FOR [ShippingTotal]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Cart_OrderTotal]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Cart] ADD  CONSTRAINT [DF_ws_Cart_OrderTotal]  DEFAULT ((0)) FOR [OrderTotal]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Cart_Created_1]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Cart] ADD  CONSTRAINT [DF_ws_Cart_Created_1]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOffers_ws_Cart]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_CartOffers]'))
ALTER TABLE [dbo].[ws_CartOffers]  WITH CHECK ADD  CONSTRAINT [FK_ws_CartOffers_ws_Cart] FOREIGN KEY([CartGuid])
REFERENCES [dbo].[ws_Cart] ([CartGuid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOffers_ws_Cart]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_CartOffers]'))
ALTER TABLE [dbo].[ws_CartOffers] CHECK CONSTRAINT [FK_ws_CartOffers_ws_Cart]

GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOffers_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_CartOffers]'))
ALTER TABLE [dbo].[ws_CartOffers]  WITH CHECK ADD  CONSTRAINT [FK_ws_CartOffers_ws_Offer] FOREIGN KEY([OfferGuid])
REFERENCES [dbo].[ws_Offer] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOffers_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_CartOffers]'))
ALTER TABLE [dbo].[ws_CartOffers] CHECK CONSTRAINT [FK_ws_CartOffers_ws_Offer]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_CartOfferItems_ItemGuid]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_CartOffers] ADD  CONSTRAINT [DF_ws_CartOfferItems_ItemGuid]  DEFAULT (newid()) FOR [ItemGuid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_CartOfferItems_AddedToCart]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_CartOffers] ADD  CONSTRAINT [DF_ws_CartOfferItems_AddedToCart]  DEFAULT (getutcdate()) FOR [AddedToCart]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_CartOfferItems_Quantity]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_CartOffers] ADD  CONSTRAINT [DF_ws_CartOfferItems_Quantity]  DEFAULT ((1)) FOR [Quantity]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_CartOffe__Tax__0D1ADB2A]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_CartOffers] ADD  DEFAULT ((0)) FOR [Tax]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Cart_CartID]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_CartOrderInfo] ADD  CONSTRAINT [DF_ws_Cart_CartID]  DEFAULT (newid()) FOR [CartGuid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Cart_CustomerEmailVerified]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_CartOrderInfo] ADD  CONSTRAINT [DF_ws_Cart_CustomerEmailVerified]  DEFAULT ((0)) FOR [CustomerEmailVerified]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_DiscountID]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF_ws_DiscountID]  DEFAULT (newid()) FOR [DiscountGuid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__Valid__382534C0]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__Valid__382534C0]  DEFAULT (getutcdate()) FOR [ValidityStartDate]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__UseCo__391958F9]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__UseCo__391958F9]  DEFAULT ((0)) FOR [UseCount]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__MaxCo__3A0D7D32]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__MaxCo__3A0D7D32]  DEFAULT ((0)) FOR [MaxCount]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__MinOr__3B01A16B]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__MinOr__3B01A16B]  DEFAULT ((0)) FOR [MinOrderAmount]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__Absol__3BF5C5A4]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__Absol__3BF5C5A4]  DEFAULT ((0)) FOR [AbsoluteDiscount]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__Perce__3CE9E9DD]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__Perce__3CE9E9DD]  DEFAULT ((0)) FOR [PercentageDiscount]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__Creat__3DDE0E16]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__Creat__3DDE0E16]  DEFAULT (getutcdate()) FOR [CreatedUtc]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF__ws_Discou__LastM__3ED2324F]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Discount] ADD  CONSTRAINT [DF__ws_Discou__LastM__3ED2324F]  DEFAULT (getutcdate()) FOR [LastModUtc]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadHistory_ws_FullfillDownloadTicket]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadHistory]'))
ALTER TABLE [dbo].[ws_FullfillDownloadHistory]  WITH CHECK ADD  CONSTRAINT [FK_ws_FullfillDownloadHistory_ws_FullfillDownloadTicket] FOREIGN KEY([TicketGuid])
REFERENCES [dbo].[ws_FullfillDownloadTicket] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadHistory_ws_FullfillDownloadTicket]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadHistory]'))
ALTER TABLE [dbo].[ws_FullfillDownloadHistory] CHECK CONSTRAINT [FK_ws_FullfillDownloadHistory_ws_FullfillDownloadTicket]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillDownloadHistory_UTCTimestamp]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadHistory] ADD  CONSTRAINT [DF_ws_FullfillDownloadHistory_UTCTimestamp]  DEFAULT (getutcdate()) FOR [UTCTimestamp]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTerms_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTerms]  WITH CHECK ADD  CONSTRAINT [FK_ws_FullfillDownloadTerms_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTerms_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTerms] CHECK CONSTRAINT [FK_ws_FullfillDownloadTerms_ws_Store]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillmentDownloadTerms_DownloadsAllowed]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTerms] ADD  CONSTRAINT [DF_ws_FullfillmentDownloadTerms_DownloadsAllowed]  DEFAULT ((1)) FOR [DownloadsAllowed]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillDownloadTerms_CountFromFirstDownload]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTerms] ADD  CONSTRAINT [DF_ws_FullfillDownloadTerms_CountFromFirstDownload]  DEFAULT ((1)) FOR [CountAfterDownload]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillmentDownloadTerms_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTerms] ADD  CONSTRAINT [DF_ws_FullfillmentDownloadTerms_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTicket_ws_FullfillDownloadTerms]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTicket]  WITH CHECK ADD  CONSTRAINT [FK_ws_FullfillDownloadTicket_ws_FullfillDownloadTerms] FOREIGN KEY([FullfillTermsGuid])
REFERENCES [dbo].[ws_FullfillDownloadTerms] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTicket_ws_FullfillDownloadTerms]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] CHECK CONSTRAINT [FK_ws_FullfillDownloadTicket_ws_FullfillDownloadTerms]

GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTicket_ws_Product]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTicket]  WITH CHECK ADD  CONSTRAINT [FK_ws_FullfillDownloadTicket_ws_Product] FOREIGN KEY([ProductGuid])
REFERENCES [dbo].[ws_Product] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTicket_ws_Product]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] CHECK CONSTRAINT [FK_ws_FullfillDownloadTicket_ws_Product]

GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTicket_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTicket]  WITH CHECK ADD  CONSTRAINT [FK_ws_FullfillDownloadTicket_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_FullfillDownloadTicket_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket]'))
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] CHECK CONSTRAINT [FK_ws_FullfillDownloadTicket_ws_Store]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillDownloadTicket_DownloadsAllowed]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] ADD  CONSTRAINT [DF_ws_FullfillDownloadTicket_DownloadsAllowed]  DEFAULT ((0)) FOR [DownloadsAllowed]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillDownloadTicket_ExpireDaysAfterPurchase]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] ADD  CONSTRAINT [DF_ws_FullfillDownloadTicket_ExpireDaysAfterPurchase]  DEFAULT ((0)) FOR [ExpireAfterDays]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillDownloadTicket_CountAfterDownload]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] ADD  CONSTRAINT [DF_ws_FullfillDownloadTicket_CountAfterDownload]  DEFAULT ((1)) FOR [CountAfterDownload]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillDownloadTicket_PurchaseTime]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] ADD  CONSTRAINT [DF_ws_FullfillDownloadTicket_PurchaseTime]  DEFAULT (getutcdate()) FOR [PurchaseTime]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_FullfillDownloadTicket_DownloadedCount]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_FullfillDownloadTicket] ADD  CONSTRAINT [DF_ws_FullfillDownloadTicket_DownloadedCount]  DEFAULT ((0)) FOR [DownloadedCount]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Offer_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Offer]'))
ALTER TABLE [dbo].[ws_Offer]  WITH CHECK ADD  CONSTRAINT [FK_ws_Offer_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Offer_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Offer]'))
ALTER TABLE [dbo].[ws_Offer] CHECK CONSTRAINT [FK_ws_Offer_ws_Store]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Offer_Guid]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Offer] ADD  CONSTRAINT [DF_ws_Offer_Guid]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Offer_IsVisible]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Offer] ADD  CONSTRAINT [DF_ws_Offer_IsVisible]  DEFAULT ((1)) FOR [IsVisible]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Offer_IsSpecial]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Offer] ADD  CONSTRAINT [DF_ws_Offer_IsSpecial]  DEFAULT ((0)) FOR [IsSpecial]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Offer_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Offer] ADD  CONSTRAINT [DF_ws_Offer_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Offer_IsDeleted]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Offer] ADD  CONSTRAINT [DF_ws_Offer_IsDeleted]  DEFAULT ((0)) FOR [IsDeleted]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_OfferAvailability_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability]'))
ALTER TABLE [dbo].[ws_OfferAvailability]  WITH CHECK ADD  CONSTRAINT [FK_ws_OfferAvailability_ws_Offer] FOREIGN KEY([OfferGuid])
REFERENCES [dbo].[ws_Offer] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_OfferAvailability_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability]'))
ALTER TABLE [dbo].[ws_OfferAvailability] CHECK CONSTRAINT [FK_ws_OfferAvailability_ws_Offer]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferDateRange_Guid]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferAvailability] ADD  CONSTRAINT [DF_ws_OfferDateRange_Guid]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferAvailability_RequiresOfferCode]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferAvailability] ADD  CONSTRAINT [DF_ws_OfferAvailability_RequiresOfferCode]  DEFAULT ((0)) FOR [RequiresOfferCode]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferAvailability_MaxAllowedPerCustomer]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferAvailability] ADD  CONSTRAINT [DF_ws_OfferAvailability_MaxAllowedPerCustomer]  DEFAULT ((0)) FOR [MaxAllowedPerCustomer]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferDateRange_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferAvailability] ADD  CONSTRAINT [DF_ws_OfferDateRange_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferDateRange_IsDeleted]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferAvailability] ADD  CONSTRAINT [DF_ws_OfferDateRange_IsDeleted]  DEFAULT ((0)) FOR [IsDeleted]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferAvailHistory_Guid]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferAvailabilityHistory] ADD  CONSTRAINT [DF_ws_OfferAvailHistory_Guid]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferAvailabilityHistory_LogTime]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferAvailabilityHistory] ADD  CONSTRAINT [DF_ws_OfferAvailabilityHistory_LogTime]  DEFAULT (getutcdate()) FOR [LogTime]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferHistory_Guid]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferHistory] ADD  CONSTRAINT [DF_ws_OfferHistory_Guid]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferHistory_LogTime]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferHistory] ADD  CONSTRAINT [DF_ws_OfferHistory_LogTime]  DEFAULT (getutcdate()) FOR [LogTime]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferPriceHistory_Guid]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferPriceHistory] ADD  CONSTRAINT [DF_ws_OfferPriceHistory_Guid]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_OfferProduct_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct]'))
ALTER TABLE [dbo].[ws_OfferProduct]  WITH CHECK ADD  CONSTRAINT [FK_ws_OfferProduct_ws_Offer] FOREIGN KEY([OfferGuid])
REFERENCES [dbo].[ws_Offer] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_OfferProduct_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct]'))
ALTER TABLE [dbo].[ws_OfferProduct] CHECK CONSTRAINT [FK_ws_OfferProduct_ws_Offer]

GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_OfferProduct_ws_Product]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct]'))
ALTER TABLE [dbo].[ws_OfferProduct]  WITH CHECK ADD  CONSTRAINT [FK_ws_OfferProduct_ws_Product] FOREIGN KEY([ProductGuid])
REFERENCES [dbo].[ws_Product] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_OfferProduct_ws_Product]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct]'))
ALTER TABLE [dbo].[ws_OfferProduct] CHECK CONSTRAINT [FK_ws_OfferProduct_ws_Product]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferProduct_FullfillType]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferProduct] ADD  CONSTRAINT [DF_ws_OfferProduct_FullfillType]  DEFAULT ((1)) FOR [FullfillType]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferProduct_Quantity]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferProduct] ADD  CONSTRAINT [DF_ws_OfferProduct_Quantity]  DEFAULT ((1)) FOR [Quantity]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferProduct_SortOrder]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferProduct] ADD  CONSTRAINT [DF_ws_OfferProduct_SortOrder]  DEFAULT ((0)) FOR [SortOrder]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferProduct_IsDeleted]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferProduct] ADD  CONSTRAINT [DF_ws_OfferProduct_IsDeleted]  DEFAULT ((0)) FOR [IsDeleted]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OfferProduct_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OfferProduct] ADD  CONSTRAINT [DF_ws_OfferProduct_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Order_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Order]'))
ALTER TABLE [dbo].[ws_Order]  WITH CHECK ADD  CONSTRAINT [FK_ws_Order_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Order_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Order]'))
ALTER TABLE [dbo].[ws_Order] CHECK CONSTRAINT [FK_ws_Order_ws_Store]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_CartOrder_OrderID]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Order] ADD  CONSTRAINT [DF_ws_CartOrder_OrderID]  DEFAULT (newid()) FOR [OrderGuid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_CartOrder_CustomerEmailVerified]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Order] ADD  CONSTRAINT [DF_ws_CartOrder_CustomerEmailVerified]  DEFAULT ((0)) FOR [CustomerEmailVerified]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Order_ShippingTotal]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Order] ADD  CONSTRAINT [DF_ws_Order_ShippingTotal]  DEFAULT ((0)) FOR [ShippingTotal]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_CartOrder_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Order] ADD  CONSTRAINT [DF_ws_CartOrder_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_OrderOfferProduct_FullfillType]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_OrderOfferProduct] ADD  CONSTRAINT [DF_ws_OrderOfferProduct_FullfillType]  DEFAULT ((0)) FOR [FullfillType]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOrderOffers_ws_CartOrder]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers]'))
ALTER TABLE [dbo].[ws_OrderOffers]  WITH CHECK ADD  CONSTRAINT [FK_ws_CartOrderOffers_ws_CartOrder] FOREIGN KEY([OrderGuid])
REFERENCES [dbo].[ws_Order] ([OrderGuid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOrderOffers_ws_CartOrder]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers]'))
ALTER TABLE [dbo].[ws_OrderOffers] CHECK CONSTRAINT [FK_ws_CartOrderOffers_ws_CartOrder]

GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOrderOffers_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers]'))
ALTER TABLE [dbo].[ws_OrderOffers]  WITH CHECK ADD  CONSTRAINT [FK_ws_CartOrderOffers_ws_Offer] FOREIGN KEY([OfferGuid])
REFERENCES [dbo].[ws_Offer] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_CartOrderOffers_ws_Offer]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers]'))
ALTER TABLE [dbo].[ws_OrderOffers] CHECK CONSTRAINT [FK_ws_CartOrderOffers_ws_Offer]

GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Product_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Product]'))
ALTER TABLE [dbo].[ws_Product]  WITH CHECK ADD  CONSTRAINT [FK_ws_Product_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_Product_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_Product]'))
ALTER TABLE [dbo].[ws_Product] CHECK CONSTRAINT [FK_ws_Product_ws_Store]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_Table_1_ID]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Product] ADD  CONSTRAINT [DF_Table_1_ID]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Product_Status]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Product] ADD  CONSTRAINT [DF_ws_Product_Status]  DEFAULT ((1)) FOR [Status]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Product_FullfillmentType]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Product] ADD  CONSTRAINT [DF_ws_Product_FullfillmentType]  DEFAULT ((1)) FOR [FullfillmentType]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Product_QuantityOnHand]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Product] ADD  CONSTRAINT [DF_ws_Product_QuantityOnHand]  DEFAULT ((0)) FOR [QuantityOnHand]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Product_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Product] ADD  CONSTRAINT [DF_ws_Product_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Product_IsDeleted]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Product] ADD  CONSTRAINT [DF_ws_Product_IsDeleted]  DEFAULT ((0)) FOR [IsDeleted]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_ProductFile_ByteLength]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_ProductFile] ADD  CONSTRAINT [DF_ws_ProductFile_ByteLength]  DEFAULT ((0)) FOR [ByteLength]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_ProductFile_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_ProductFile] ADD  CONSTRAINT [DF_ws_ProductFile_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ProductHistory_ID]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_ProductHistory] ADD  CONSTRAINT [DF_ProductHistory_ID]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_ProductHistory_LastModified]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_ProductHistory] ADD  CONSTRAINT [DF_ws_ProductHistory_LastModified]  DEFAULT (getutcdate()) FOR [LastModified]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Store_Guid]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Store] ADD  CONSTRAINT [DF_ws_Store_Guid]  DEFAULT (newid()) FOR [Guid]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Store_IsOpen]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Store] ADD  CONSTRAINT [DF_ws_Store_IsOpen]  DEFAULT ((0)) FOR [IsClosed]
END


GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_Store_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_Store] ADD  CONSTRAINT [DF_ws_Store_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_StoreCurrency_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_StoreCurrency]'))
ALTER TABLE [dbo].[ws_StoreCurrency]  WITH CHECK ADD  CONSTRAINT [FK_ws_StoreCurrency_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_StoreCurrency_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_StoreCurrency]'))
ALTER TABLE [dbo].[ws_StoreCurrency] CHECK CONSTRAINT [FK_ws_StoreCurrency_ws_Store]

GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[DF_ws_StoreCurrency_Created]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ws_StoreCurrency] ADD  CONSTRAINT [DF_ws_StoreCurrency_Created]  DEFAULT (getutcdate()) FOR [Created]
END


GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_StoreLanguage_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_StoreLanguage]'))
ALTER TABLE [dbo].[ws_StoreLanguage]  WITH CHECK ADD  CONSTRAINT [FK_ws_StoreLanguage_ws_Store] FOREIGN KEY([StoreGuid])
REFERENCES [dbo].[ws_Store] ([Guid])

GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ws_StoreLanguage_ws_Store]') AND parent_object_id = OBJECT_ID(N'[dbo].[ws_StoreLanguage]'))
ALTER TABLE [dbo].[ws_StoreLanguage] CHECK CONSTRAINT [FK_ws_StoreLanguage_ws_Store]

GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Cart_Delete]

/*
Author:   			Joe Audette
Created: 			3/5/2007
Last Modified: 		3/5/2007
*/

@CartGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_Cart]
WHERE
	[CartGuid] = @CartGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_DeleteAnonymousByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Cart_DeleteAnonymousByStore]

/*
Author:   			Joe Audette
Created: 			2008-10-18
Last Modified: 		2008-10-18
*/

@StoreGuid uniqueidentifier,
@OlderThan DateTime

AS

DELETE FROM [dbo].[ws_Cart]
WHERE
	[CartGuid] IN
(
SELECT CartGuid 
FROM [dbo].[ws_Cart]
WHERE	StoreGuid = @StoreGuid
		AND UserGuid = ''00000000-0000-0000-0000-000000000000''
		AND Created < @OlderThan
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_DeleteByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Cart_DeleteByStore]

/*
Author:   			Joe Audette
Created: 			2008-10-18
Last Modified: 		2008-10-18
*/

@StoreGuid uniqueidentifier,
@OlderThan DateTime

AS

DELETE FROM [dbo].[ws_Cart]
WHERE
	[CartGuid] IN
(
SELECT CartGuid 
FROM [dbo].[ws_Cart]
WHERE	StoreGuid = @StoreGuid
		AND Created < @OlderThan
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_GetCountByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].ws_Cart_GetCountByStore

/*
Author:   			Joe Audette
Created: 			2008-3-26
Last Modified: 		2008-3-26
*/

@StoreGuid uniqueidentifier

AS

SELECT COUNT(*) FROM [dbo].[ws_Cart]
WHERE StoreGuid = @StoreGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_GetItemCountByFulfillmentType]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[ws_Cart_GetItemCountByFulfillmentType]

/*
Author:   			Joe Audette
Created: 			2009-04-25
Last Modified: 		2009-04-25
*/

@CartGuid uniqueidentifier,
@FulFillmentType tinyint

AS

SELECT COUNT(*)
FROM	[dbo].ws_OfferProduct op
JOIN
	[dbo].ws_CartOffers co
ON
	op.OfferGuid = co.OfferGuid

WHERE
co.CartGuid = @CartGuid
AND
op.FullfillType = @FulFillmentType
AND op.IsDeleted = 0


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Cart_Insert]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2009-07-28
*/

@CartGuid uniqueidentifier,
@StoreGuid uniqueidentifier,
@UserGuid uniqueidentifier,
@SubTotal decimal(15, 4),
@ShippingTotal decimal(15, 4),
@TaxTotal decimal(15, 4),
@OrderTotal decimal(15, 4),
@Created datetime,
@CreatedFromIP nvarchar(255),
@LastModified datetime,
@LastUserActivity datetime,
@CustomData nvarchar(max),
@DiscountCodesCsv nvarchar(max),
@Discount decimal(15,4),
@ClerkGuid uniqueidentifier

	
AS
INSERT INTO 	[dbo].[ws_Cart] 
(
				[CartGuid],
				[StoreGuid],
				[UserGuid],
				[SubTotal],
				[ShippingTotal],
				[TaxTotal],
				[OrderTotal],
				[Created],
				[CreatedFromIP],
				[LastModified],
				[LastUserActivity],
				CustomData,
				DiscountCodesCsv,
				Discount,
				ClerkGuid
) 

VALUES 
(
				@CartGuid,
				@StoreGuid,
				@UserGuid,
				@SubTotal,
				@ShippingTotal,
				@TaxTotal,
				@OrderTotal,
				@Created,
				@CreatedFromIP,
				@LastModified,
				@LastUserActivity,
				@CustomData,
				@DiscountCodesCsv,
				@Discount,
				@ClerkGuid
				
)


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Cart_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-10-18
*/

@CartGuid uniqueidentifier

AS
SELECT *
		
FROM
		[dbo].[ws_Cart]
		
WHERE
		[CartGuid] = @CartGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_SelectOneByUser]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Cart_SelectOneByUser]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-10-18
*/

@UserGuid uniqueidentifier

AS
SELECT	TOP 1 *
		
FROM
		[dbo].[ws_Cart]
		
WHERE
		[UserGuid] = @UserGuid

ORDER BY [LastModified] DESC

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_SelectPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Cart_SelectPage]

-- Author:   			Joe Audette
-- Created: 			2008-03-26
-- Last Modified: 		2008-08-21

@StoreGuid		uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS

DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1


CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
CartGuid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
CartGuid
)

SELECT
		[CartGuid]
		
FROM
		[dbo].[ws_Cart]
		
WHERE		StoreGuid = @StoreGuid

ORDER BY
		LastModified DESC

END


SELECT
		c.*,
		u.Name,
		u.LoginName,
		u.Email,
		(SELECT TOP 1 u2.Email FROM [dbo].mp_Users u2 WHERE u2.UserGuid IN 
			(SELECT UserGuid FROM [dbo].mp_UserLocation WHERE IPAddress = c.CreatedFromIP)) As IPUser
		
FROM
		[dbo].[ws_Cart] c

JOIN			#PageIndex t2
ON			
		c.[CartGuid] = t2.[CartGuid]
		
LEFT OUTER JOIN 
		[dbo].mp_Users u
ON 
		u.UserGuid = c.UserGuid
		
WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Cart_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Cart_Update]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2009-07-29
*/
	
@CartGuid uniqueidentifier, 
@UserGuid uniqueidentifier, 
@SubTotal decimal(15, 4), 
@ShippingTotal decimal(15, 4), 
@TaxTotal decimal(15, 4), 
@OrderTotal decimal(15, 4), 
@LastModified datetime, 
@LastUserActivity datetime,
@CustomData nvarchar(max),
@DiscountCodesCsv nvarchar(max),
@Discount decimal(15,4),
@ClerkGuid uniqueidentifier


AS
UPDATE 		[dbo].[ws_Cart] 

SET
			
			[UserGuid] = @UserGuid,
			[SubTotal] = @SubTotal,
			[ShippingTotal] = @ShippingTotal,
			[TaxTotal] = @TaxTotal,
			[OrderTotal] = @OrderTotal,
			[LastModified] = @LastModified,
			[LastUserActivity] = @LastUserActivity,
			CustomData = @CustomData,
			DiscountCodesCsv = @DiscountCodesCsv,
			Discount =@Discount,
			ClerkGuid = @ClerkGuid
			
WHERE
			[CartGuid] = @CartGuid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_CartOffers_Delete]

/*
Author:   			Joe Audette
Created: 			3/5/2007
Last Modified: 		3/5/2007
*/

@ItemGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_CartOffers]
WHERE
	[ItemGuid] = @ItemGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_DeleteAnonymousByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOffers_DeleteAnonymousByStore]

/*
Author:   			Joe Audette
Created: 			2008-10-18
Last Modified: 		2008-10-18
*/

@StoreGuid uniqueidentifier,
@OlderThan DateTime

AS

DELETE FROM [dbo].[ws_CartOffers]
WHERE
	[CartGuid] IN
(
SELECT CartGuid 
FROM [dbo].[ws_Cart]
WHERE	StoreGuid = @StoreGuid
		AND UserGuid = ''00000000-0000-0000-0000-000000000000''
		AND Created < @OlderThan
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_DeleteByCart]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_CartOffers_DeleteByCart]

/*
Author:   			Joe Audette
Created: 			3/27/2007
Last Modified: 		3/27/2007
*/

@CartGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_CartOffers]
WHERE
	[CartGuid] = @CartGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_DeleteByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOffers_DeleteByStore]

/*
Author:   			Joe Audette
Created: 			2008-10-18
Last Modified: 		2008-10-18
*/

@StoreGuid uniqueidentifier,
@OlderThan DateTime

AS

DELETE FROM [dbo].[ws_CartOffers]
WHERE
	[CartGuid] IN
(
SELECT CartGuid 
FROM [dbo].[ws_Cart]
WHERE	StoreGuid = @StoreGuid
		AND Created < @OlderThan
)


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOffers_Insert]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-10-17
*/

@ItemGuid uniqueidentifier,
@CartGuid uniqueidentifier,
@OfferGuid uniqueidentifier,
@OfferPrice decimal(15, 4),
@AddedToCart datetime,
@Quantity int,
@TaxClassGuid uniqueidentifier,
@Tax decimal(15, 4),
@IsDonation bit

	
AS
INSERT INTO 	[dbo].[ws_CartOffers] 
(
				[ItemGuid],
				[CartGuid],
				[OfferGuid],
				[OfferPrice],
				[AddedToCart],
				[Quantity],
				[TaxClassGuid],
				[Tax],
				[IsDonation]
) 

VALUES 
(
				@ItemGuid,
				@CartGuid,
				@OfferGuid,
				@OfferPrice,
				@AddedToCart,
				@Quantity,
				@TaxClassGuid,
				@Tax,
				@IsDonation
				
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_SelectByCart]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_CartOffers_SelectByCart]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-10-17
*/

@CartGuid uniqueidentifier

AS
SELECT
		co.[ItemGuid],
		co.[CartGuid],
		co.[OfferGuid],
		co.[OfferPrice],
		co.[AddedToCart],
		co.[Quantity],
		co.[TaxClassGuid],
		co.[Tax],
		co.[IsDonation],
		o.[Name],
		o.[Description],
		o.Price

		
FROM
		[dbo].[ws_CartOffers] co

JOIN
		[dbo].[ws_Offer] o

ON		co.OfferGuid = o.Guid



		
WHERE
		co.[CartGuid] = @CartGuid



ORDER BY
		co.[AddedToCart]


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOffers_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-07-10
*/

@ItemGuid uniqueidentifier

AS
SELECT *
		
FROM
		[dbo].[ws_CartOffers]
		
WHERE
		[ItemGuid] = @ItemGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOffers_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOffers_Update]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-10-17
*/
	
@ItemGuid uniqueidentifier, 
@OfferGuid uniqueidentifier, 
@OfferPrice decimal(15, 4), 
@AddedToCart datetime, 
@Quantity int,
@TaxClassGuid uniqueidentifier,
@Tax decimal(15,4),
@IsDonation bit


AS
UPDATE 		[dbo].[ws_CartOffers] 

SET
			
			[OfferGuid] = @OfferGuid,
			[OfferPrice] = @OfferPrice,
			[AddedToCart] = @AddedToCart,
			[Quantity] = @Quantity,
			[TaxClassGuid] = @TaxClassGuid,
			[Tax] = @Tax,
			[IsDonation] = @IsDonation
			
WHERE
			[ItemGuid] = @ItemGuid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOrderInfo_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_CartOrderInfo_Delete]

/*
Author:   			Joe Audette
Created: 			3/5/2007
Last Modified: 		3/5/2007
*/

@CartGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_CartOrderInfo]
WHERE
	[CartGuid] = @CartGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOrderInfo_DeleteAnonymousByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOrderInfo_DeleteAnonymousByStore]

/*
Author:   			Joe Audette
Created: 			2008-10-18
Last Modified: 		2008-10-18
*/

@StoreGuid uniqueidentifier,
@OlderThan DateTime

AS

DELETE FROM [dbo].[ws_CartOrderInfo]
WHERE
	[CartGuid] IN
(
SELECT CartGuid 
FROM [dbo].[ws_Cart]
WHERE	StoreGuid = @StoreGuid
		AND UserGuid = ''00000000-0000-0000-0000-000000000000''
		AND Created < @OlderThan
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOrderInfo_DeleteByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOrderInfo_DeleteByStore]

/*
Author:   			Joe Audette
Created: 			2008-10-18
Last Modified: 		2008-10-18
*/

@StoreGuid uniqueidentifier,
@OlderThan DateTime

AS

DELETE FROM [dbo].[ws_CartOrderInfo]
WHERE
	[CartGuid] IN
(
SELECT CartGuid 
FROM [dbo].[ws_Cart]
WHERE	StoreGuid = @StoreGuid
		AND Created < @OlderThan
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOrderInfo_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOrderInfo_Insert]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-07-09
*/

@CartGuid uniqueidentifier,
@CustomerFirstName nvarchar(100),
@CustomerLastName nvarchar(100),
@CustomerCompany nvarchar(255),
@CustomerAddressLine1 nvarchar(255),
@CustomerAddressLine2 nvarchar(255),
@CustomerSuburb nvarchar(255),
@CustomerCity nvarchar(255),
@CustomerPostalCode nvarchar(20),
@CustomerState nvarchar(255),
@CustomerCountry nvarchar(255),
@CustomerTelephoneDay nvarchar(32),
@CustomerTelephoneNight nvarchar(32),
@CustomerEmail nvarchar(96),
@CustomerEmailVerified bit,
@DeliveryFirstName nvarchar(100),
@DeliveryLastName nvarchar(100),
@DeliveryCompany nvarchar(255),
@DeliveryAddress1 nvarchar(255),
@DeliveryAddress2 nvarchar(255),
@DeliverySuburb nvarchar(255),
@DeliveryCity nvarchar(255),
@DeliveryPostalCode nvarchar(20),
@DeliveryState nvarchar(255),
@DeliveryCountry nvarchar(255),
@BillingFirstName nvarchar(100),
@BillingLastName nvarchar(100),
@BillingCompany nvarchar(255),
@BillingAddress1 nvarchar(255),
@BillingAddress2 nvarchar(255),
@BillingSuburb nvarchar(255),
@BillingCity nvarchar(255),
@BillingPostalCode nvarchar(20),
@BillingState nvarchar(255),
@BillingCountry nvarchar(255),
@CardTypeGuid uniqueidentifier,
@CardOwner nvarchar(100),
@CardNumber nvarchar(255),
@CardExpires nvarchar(6),
@CardSecurityCode nvarchar(50),
@Completed datetime,
@CompletedFromIP nvarchar(255),
@TaxZoneGuid uniqueidentifier

	
AS
INSERT INTO 	[dbo].[ws_CartOrderInfo] 
(
				[CartGuid],
				[CustomerFirstName],
				[CustomerLastName],
				[CustomerCompany],
				[CustomerAddressLine1],
				[CustomerAddressLine2],
				[CustomerSuburb],
				[CustomerCity],
				[CustomerPostalCode],
				[CustomerState],
				[CustomerCountry],
				[CustomerTelephoneDay],
				[CustomerTelephoneNight],
				[CustomerEmail],
				[CustomerEmailVerified],
				[DeliveryFirstName],
				[DeliveryLastName],
				[DeliveryCompany],
				[DeliveryAddress1],
				[DeliveryAddress2],
				[DeliverySuburb],
				[DeliveryCity],
				[DeliveryPostalCode],
				[DeliveryState],
				[DeliveryCountry],
				[BillingFirstName],
				[BillingLastName],
				[BillingCompany],
				[BillingAddress1],
				[BillingAddress2],
				[BillingSuburb],
				[BillingCity],
				[BillingPostalCode],
				[BillingState],
				[BillingCountry],
				[CardTypeGuid],
				[CardOwner],
				[CardNumber],
				[CardExpires],
				[CardSecurityCode],
				[Completed],
				[CompletedFromIP],
				[TaxZoneGuid]
) 

VALUES 
(
				@CartGuid,
				@CustomerFirstName,
				@CustomerLastName,
				@CustomerCompany,
				@CustomerAddressLine1,
				@CustomerAddressLine2,
				@CustomerSuburb,
				@CustomerCity,
				@CustomerPostalCode,
				@CustomerState,
				@CustomerCountry,
				@CustomerTelephoneDay,
				@CustomerTelephoneNight,
				@CustomerEmail,
				@CustomerEmailVerified,
				@DeliveryFirstName,
				@DeliveryLastName,
				@DeliveryCompany,
				@DeliveryAddress1,
				@DeliveryAddress2,
				@DeliverySuburb,
				@DeliveryCity,
				@DeliveryPostalCode,
				@DeliveryState,
				@DeliveryCountry,
				@BillingFirstName,
				@BillingLastName,
				@BillingCompany,
				@BillingAddress1,
				@BillingAddress2,
				@BillingSuburb,
				@BillingCity,
				@BillingPostalCode,
				@BillingState,
				@BillingCountry,
				@CardTypeGuid,
				@CardOwner,
				@CardNumber,
				@CardExpires,
				@CardSecurityCode,
				@Completed,
				@CompletedFromIP,
				@TaxZoneGuid
				
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOrderInfo_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOrderInfo_SelectOne]

/*
Author:   			Joe Audette
Created: 			3/5/2007
Last Modified: 		3/5/2007
*/

@CartGuid uniqueidentifier

AS
SELECT *
		
FROM
		[dbo].[ws_CartOrderInfo]
		
WHERE
		[CartGuid] = @CartGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_CartOrderInfo_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_CartOrderInfo_Update]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2008-07-09
*/
	
@CartGuid uniqueidentifier, 
@CustomerFirstName nvarchar(100),
@CustomerLastName nvarchar(100), 
@CustomerCompany nvarchar(255), 
@CustomerAddressLine1 nvarchar(255), 
@CustomerAddressLine2 nvarchar(255), 
@CustomerSuburb nvarchar(255), 
@CustomerCity nvarchar(255), 
@CustomerPostalCode nvarchar(20), 
@CustomerState nvarchar(255), 
@CustomerCountry nvarchar(255), 
@CustomerTelephoneDay nvarchar(32), 
@CustomerTelephoneNight nvarchar(32), 
@CustomerEmail nvarchar(96), 
@CustomerEmailVerified bit, 
@DeliveryFirstName nvarchar(100), 
@DeliveryLastName nvarchar(100),
@DeliveryCompany nvarchar(255), 
@DeliveryAddress1 nvarchar(255), 
@DeliveryAddress2 nvarchar(255), 
@DeliverySuburb nvarchar(255), 
@DeliveryCity nvarchar(255), 
@DeliveryPostalCode nvarchar(20), 
@DeliveryState nvarchar(255), 
@DeliveryCountry nvarchar(255), 
@BillingFirstName nvarchar(100), 
@BillingLastName nvarchar(100),
@BillingCompany nvarchar(255), 
@BillingAddress1 nvarchar(255), 
@BillingAddress2 nvarchar(255), 
@BillingSuburb nvarchar(255), 
@BillingCity nvarchar(255), 
@BillingPostalCode nvarchar(20), 
@BillingState nvarchar(255), 
@BillingCountry nvarchar(255), 
@CardTypeGuid uniqueidentifier, 
@CardOwner nvarchar(100), 
@CardNumber nvarchar(255), 
@CardExpires nvarchar(6), 
@CardSecurityCode nvarchar(50), 
@Completed datetime, 
@CompletedFromIP nvarchar(255),
@TaxZoneGuid uniqueidentifier


AS
UPDATE 		[dbo].[ws_CartOrderInfo] 

SET
			[CustomerFirstName] = @CustomerFirstName,
			[CustomerLastName] = @CustomerLastName,
			[CustomerCompany] = @CustomerCompany,
			[CustomerAddressLine1] = @CustomerAddressLine1,
			[CustomerAddressLine2] = @CustomerAddressLine2,
			[CustomerSuburb] = @CustomerSuburb,
			[CustomerCity] = @CustomerCity,
			[CustomerPostalCode] = @CustomerPostalCode,
			[CustomerState] = @CustomerState,
			[CustomerCountry] = @CustomerCountry,
			[CustomerTelephoneDay] = @CustomerTelephoneDay,
			[CustomerTelephoneNight] = @CustomerTelephoneNight,
			[CustomerEmail] = @CustomerEmail,
			[CustomerEmailVerified] = @CustomerEmailVerified,
			[DeliveryFirstName] = @DeliveryFirstName,
			[DeliveryLastName] = @DeliveryLastName,
			[DeliveryCompany] = @DeliveryCompany,
			[DeliveryAddress1] = @DeliveryAddress1,
			[DeliveryAddress2] = @DeliveryAddress2,
			[DeliverySuburb] = @DeliverySuburb,
			[DeliveryCity] = @DeliveryCity,
			[DeliveryPostalCode] = @DeliveryPostalCode,
			[DeliveryState] = @DeliveryState,
			[DeliveryCountry] = @DeliveryCountry,
			[BillingFirstName] = @BillingFirstName,
			[BillingLastName] = @BillingLastName,
			[BillingCompany] = @BillingCompany,
			[BillingAddress1] = @BillingAddress1,
			[BillingAddress2] = @BillingAddress2,
			[BillingSuburb] = @BillingSuburb,
			[BillingCity] = @BillingCity,
			[BillingPostalCode] = @BillingPostalCode,
			[BillingState] = @BillingState,
			[BillingCountry] = @BillingCountry,
			[CardTypeGuid] = @CardTypeGuid,
			[CardOwner] = @CardOwner,
			[CardNumber] = @CardNumber,
			[CardExpires] = @CardExpires,
			[CardSecurityCode] = @CardSecurityCode,
			[Completed] = @Completed,
			[CompletedFromIP] = @CompletedFromIP,
			[TaxZoneGuid] = @TaxZoneGuid
			
WHERE
			[CartGuid] = @CartGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_Delete]

/*
Author:   			Joe Audette
Created: 			2009-3-3
Last Modified: 		2009-3-3
*/

@DiscountGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_Discount]
WHERE
	[DiscountGuid] = @DiscountGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_DeleteByModule]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_DeleteByModule]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/

@ModuleGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_Discount]
WHERE
	[ModuleGuid] = @ModuleGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_DeleteByOffer]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_DeleteByOffer]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/

@OfferGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_Discount]
WHERE
	[OfferGuid] = @OfferGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_DeleteBySite]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_DeleteBySite]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/

@SiteGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_Discount]
WHERE
	[SiteGuid] = @SiteGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_Find]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_Find]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/

@ModuleGuid uniqueidentifier,
@Description nvarchar(255)

AS


SELECT	*
		
FROM
		[dbo].[ws_Discount]
		
WHERE
		[ModuleGuid] = @ModuleGuid
		AND (
			([Description] LIKE ''%'' + @Description + ''%'')
			OR (DiscountCode = @Description)
			)

ORDER BY
		[Description]
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_GetCount]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_GetCount]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/

@ModuleGuid uniqueidentifier

AS

SELECT COUNT(*) FROM [dbo].[ws_Discount]
WHERE ModuleGuid = @ModuleGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_GetCountOfActive]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Discount_GetCountOfActive]

/*
Author:   			Joe Audette
Created: 			2009-03-06
Last Modified: 		2009-03-06
*/

@ModuleGuid uniqueidentifier,
@CurrentDate datetime

AS

SELECT COUNT(*) FROM [dbo].[ws_Discount]
WHERE 
ModuleGuid = @ModuleGuid
AND (ValidityStartDate <= @CurrentDate)
AND ((ValidityEndDate IS NULL) OR (ValidityEndDate >= @CurrentDate))

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Discount_Insert]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-04
*/

@DiscountGuid uniqueidentifier,
@DiscountCode nvarchar(255),
@Description nvarchar(255),
@SiteGuid uniqueidentifier,
@ModuleGuid uniqueidentifier,
@StoreGuid uniqueidentifier,
@OfferGuid uniqueidentifier,
@ValidityStartDate datetime,
@ValidityEndDate datetime,
@UseCount int,
@MaxCount int,
@MinOrderAmount decimal(15, 4),
@AbsoluteDiscount decimal(15, 4),
@PercentageDiscount decimal(15, 4),
@CreatedBy uniqueidentifier,
@CreatedUtc datetime,
@LastModBy uniqueidentifier,
@LastModUtc datetime,
@AllowOtherDiscounts bit

	
AS

INSERT INTO 	[dbo].[ws_Discount] 
(
				[DiscountGuid],
				[DiscountCode],
				[Description],
				[SiteGuid],
				[ModuleGuid],
				[StoreGuid],
				[OfferGuid],
				[ValidityStartDate],
				[ValidityEndDate],
				[UseCount],
				[MaxCount],
				[MinOrderAmount],
				[AbsoluteDiscount],
				[PercentageDiscount],
				[CreatedBy],
				[CreatedUtc],
				[LastModBy],
				[LastModUtc],
				AllowOtherDiscounts
) 

VALUES 
(
				@DiscountGuid,
				@DiscountCode,
				@Description,
				@SiteGuid,
				@ModuleGuid,
				@StoreGuid,
				@OfferGuid,
				@ValidityStartDate,
				@ValidityEndDate,
				@UseCount,
				@MaxCount,
				@MinOrderAmount,
				@AbsoluteDiscount,
				@PercentageDiscount,
				@CreatedBy,
				@CreatedUtc,
				@LastModBy,
				@LastModUtc,
				@AllowOtherDiscounts
				
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_SelectByDiscountCode]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_SelectByDiscountCode]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/

@ModuleGuid uniqueidentifier,
@DiscountCode nvarchar(255)

AS


SELECT	*
		
FROM
		[dbo].[ws_Discount]
		
WHERE
		[ModuleGuid] = @ModuleGuid
		AND DiscountCode = @DiscountCode
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_SelectOne]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/

@DiscountGuid uniqueidentifier

AS


SELECT	*
		
FROM
		[dbo].[ws_Discount]
		
WHERE
		[DiscountGuid] = @DiscountGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_SelectPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Discount_SelectPage]

-- Author:   			Joe Audette
-- Created: 			2009-03-03
-- Last Modified: 		2009-03-03

@ModuleGuid uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS

DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1


CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
DiscountGuid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
DiscountGuid
)

SELECT
		[DiscountGuid]
		
FROM
		[dbo].[ws_Discount]
		
WHERE	ModuleGuid = @ModuleGuid

ORDER BY
		[Description]

END


SELECT
		t1.*
		
FROM
		[dbo].[ws_Discount] t1

JOIN			#PageIndex t2
ON			
		t1.[DiscountGuid] = t2.[DiscountGuid]
		
WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Discount_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Discount_Update]

/*
Author:   			Joe Audette
Created: 			2009-03-03
Last Modified: 		2009-03-03
*/
	
@DiscountGuid uniqueidentifier, 
@DiscountCode nvarchar(255), 
@Description nvarchar(255), 
@OfferGuid uniqueidentifier, 
@ValidityStartDate datetime, 
@ValidityEndDate datetime, 
@UseCount int, 
@MaxCount int, 
@MinOrderAmount decimal(15, 4), 
@AbsoluteDiscount decimal(15, 4), 
@PercentageDiscount decimal(15, 4), 
@LastModBy uniqueidentifier, 
@LastModUtc datetime,
@AllowOtherDiscounts bit


AS

UPDATE 		[dbo].[ws_Discount] 

SET
			[DiscountCode] = @DiscountCode,
			[Description] = @Description,
			[OfferGuid] = @OfferGuid,
			[ValidityStartDate] = @ValidityStartDate,
			[ValidityEndDate] = @ValidityEndDate,
			[UseCount] = @UseCount,
			[MaxCount] = @MaxCount,
			[MinOrderAmount] = @MinOrderAmount,
			[AbsoluteDiscount] = @AbsoluteDiscount,
			[PercentageDiscount] = @PercentageDiscount,
			[LastModBy] = @LastModBy,
			[LastModUtc] = @LastModUtc,
			AllowOtherDiscounts = @AllowOtherDiscounts
			
WHERE
			[DiscountGuid] = @DiscountGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadHistory_CountByTicket]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadHistory_CountByTicket]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/

@TicketGuid uniqueidentifier

AS


SELECT
		Count(*)
		
FROM
		[dbo].[ws_FullfillDownloadHistory]
		
WHERE
		[TicketGuid] = @TicketGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadHistory_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadHistory_Insert]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/

@Guid uniqueidentifier,
@TicketGuid uniqueidentifier,
@UTCTimestamp datetime,
@IPAddress nvarchar(255)

	
AS

INSERT INTO 	[dbo].[ws_FullfillDownloadHistory] 
(
				[Guid],
				[TicketGuid],
				[UTCTimestamp],
				[IPAddress]
) 

VALUES 
(
				@Guid,
				@TicketGuid,
				@UTCTimestamp,
				@IPAddress
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadHistory_SelectByTicket]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_FullfillDownloadHistory_SelectByTicket]

/*
Author:   			Joe Audette
Created: 			2009-07-01
Last Modified: 		2009-07-01
*/

@TicketGuid uniqueidentifier

AS


SELECT	*
		
FROM
		[dbo].[ws_FullfillDownloadHistory]
		
WHERE
		[TicketGuid] = @TicketGuid
ORDER BY
		[UTCTimestamp]
	

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadHistory_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadHistory_SelectOne]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/

@Guid uniqueidentifier

AS


SELECT
		[Guid],
		[TicketGuid],
		[UTCTimestamp],
		[IPAddress]
		
FROM
		[dbo].[ws_FullfillDownloadHistory]
		
WHERE
		[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadTerms_Delete]

/*
Author:   			Joe Audette
Created: 			2/23/2007
Last Modified: 		2/23/2007
*/

@Guid uniqueidentifier

AS

DELETE FROM [dbo].[ws_FullfillDownloadTerms]
WHERE
	[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER OFF
GO
--~ StoredProcedure [dbo].[ws_FullfillDownloadTerms_Insert] -- Replaced column type ntext with nvarchar(max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_FullfillDownloadTerms_Insert]

/*
Author:   			Joe Audette
Created: 			2007-02-23
Last Modified: 		2008-12-28
*/

@Guid uniqueidentifier,
@StoreGuid uniqueidentifier,
@DownloadsAllowed int,
@ExpireAfterDays int,
@CountAfterDownload bit,
@Created datetime,
@CreatedBy uniqueidentifier,
@CreatedFromIP nvarchar(255),
@LastModified datetime,
@LastModifedBy uniqueidentifier,
@LastModifedFromIPAddress nvarchar(255),
@Name nvarchar(255),
@Description nvarchar(max) 

	
AS

INSERT INTO 	[dbo].[ws_FullfillDownloadTerms] 
(
				[Guid],
				[StoreGuid],
				[DownloadsAllowed],
				[ExpireAfterDays],
				[CountAfterDownload],
				[Created],
				[CreatedBy],
				[CreatedFromIP],
				[LastModified],
				[LastModifedBy],
				[LastModifedFromIPAddress],
				[Name],
				[Description]
) 

VALUES 
(
				@Guid,
				@StoreGuid,
				@DownloadsAllowed,
				@ExpireAfterDays,
				@CountAfterDownload,
				@Created,
				@CreatedBy,
				@CreatedFromIP,
				@LastModified,
				@LastModifedBy,
				@LastModifedFromIPAddress,
				@Name,
				@Description
				
)


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms_SelectAll]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_FullfillDownloadTerms_SelectAll]

/*
Author:   			Joe Audette
Created: 			2007-02-23
Last Modified: 		2008-12-28
*/

@StoreGuid uniqueidentifier

AS
SELECT *
		
FROM
		[dbo].[ws_FullfillDownloadTerms] 

WHERE
		[StoreGuid] = @StoreGuid

ORDER BY
		[Name]

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_FullfillDownloadTerms_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-02-23
Last Modified: 		2008-12-28
*/

@Guid uniqueidentifier

AS
SELECT*
			
FROM
		[dbo].[ws_FullfillDownloadTerms]
		
WHERE
		[Guid] = @Guid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_FullfillDownloadTerms_SelectPage] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms_SelectPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_FullfillDownloadTerms_SelectPage]

-- Author:   			Joe Audette
-- Created: 			2007-02-23
-- Last Modified: 		2008-12-28

@StoreGuid uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( Guid
)

SELECT
		dt.[Guid]
		
FROM
		[dbo].[ws_FullfillDownloadTerms] dt

WHERE	dt.[StoreGuid] = @StoreGuid

ORDER BY dt.[Name]

END

DECLARE @TotalRows int
DECLARE @TotalPages int
DECLARE @Remainder int

SET @TotalRows = (SELECT Count(*) FROM #PageIndex)
SET @TotalPages = @TotalRows / @PageSize
SET @Remainder = @TotalRows % @PageSize
IF @Remainder > 0 
SET @TotalPages = @TotalPages + 1


SELECT
		t1.*,
		
		@TotalPages AS TotalPages
		
FROM
		[dbo].[ws_FullfillDownloadTerms] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]
	
WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex

' 
END
GO
SET QUOTED_IDENTIFIER OFF
GO
--~ StoredProcedure [dbo].[ws_FullfillDownloadTerms_Update] -- Replaced column type ntext with nvarchar(max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTerms_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_FullfillDownloadTerms_Update]

/*
Author:   			Joe Audette
Created: 			2007-02-23
Last Modified: 		2008-12-28
*/
	
@Guid uniqueidentifier, 
@DownloadsAllowed int, 
@ExpireAfterDays int, 
@CountAfterDownload bit, 
@LastModified datetime, 
@LastModifedBy uniqueidentifier, 
@LastModifedFromIPAddress nvarchar(255),
@Name nvarchar(255),
@Description nvarchar(max) 


AS

UPDATE 		[dbo].[ws_FullfillDownloadTerms] 

SET
			[DownloadsAllowed] = @DownloadsAllowed,
			[ExpireAfterDays] = @ExpireAfterDays,
			[CountAfterDownload] = @CountAfterDownload,
			[LastModified] = @LastModified,
			[LastModifedBy] = @LastModifedBy,
			[LastModifedFromIPAddress] = @LastModifedFromIPAddress,
			[Name] = @Name,
			[Description] = @Description
			
WHERE
			[Guid] = @Guid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadTicket_Delete]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/

@Guid uniqueidentifier

AS

DELETE FROM [dbo].[ws_FullfillDownloadTicket]
WHERE
	[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket_IncrementDownloadCount]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadTicket_IncrementDownloadCount]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/
	
@Guid uniqueidentifier

AS

UPDATE 		[dbo].[ws_FullfillDownloadTicket] 

SET
			[DownloadedCount] = [DownloadedCount] + 1
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadTicket_Insert]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/

@Guid uniqueidentifier,
@StoreGuid uniqueidentifier,
@OrderGuid uniqueidentifier,
@UserGuid uniqueidentifier,
@ProductGuid uniqueidentifier,
@FullfillTermsGuid uniqueidentifier,
@DownloadsAllowed int,
@ExpireAfterDays int,
@CountAfterDownload bit,
@PurchaseTime datetime,
@DownloadedCount int

	
AS

INSERT INTO 	[dbo].[ws_FullfillDownloadTicket] 
(
				[Guid],
				[StoreGuid],
				[OrderGuid],
				[UserGuid],
				[ProductGuid],
				[FullfillTermsGuid],
				[DownloadsAllowed],
				[ExpireAfterDays],
				[CountAfterDownload],
				[PurchaseTime],
				[DownloadedCount]
) 

VALUES 
(
				@Guid,
				@StoreGuid,
				@OrderGuid,
				@UserGuid,
				@ProductGuid,
				@FullfillTermsGuid,
				@DownloadsAllowed,
				@ExpireAfterDays,
				@CountAfterDownload,
				@PurchaseTime,
				@DownloadedCount
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket_SelectByOrder]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_FullfillDownloadTicket_SelectByOrder]

/*
Author:   			Joe Audette
Created: 			2007-03-25
Last Modified: 		2008-10-17
*/

@OrderGuid uniqueidentifier

AS


SELECT
		fdt.[Guid],
		fdt.[StoreGuid],
		fdt.[OrderGuid],
		fdt.[UserGuid],
		fdt.[ProductGuid],
		fdt.[FullfillTermsGuid],
		fdt.[DownloadsAllowed],
		fdt.[ExpireAfterDays],
		fdt.[CountAfterDownload],
		fdt.[PurchaseTime],
		fdt.[DownloadedCount],
		pd.[Name]
		
FROM
		[dbo].[ws_FullfillDownloadTicket] fdt

LEFT OUTER JOIN
		[dbo].[ws_Product] pd

ON		fdt.[ProductGuid] = pd.Guid

		
WHERE
		fdt.[OrderGuid] = @OrderGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadTicket_SelectOne]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/

@Guid uniqueidentifier

AS


SELECT
		[Guid],
		[StoreGuid],
		[OrderGuid],
		[UserGuid],
		[ProductGuid],
		[FullfillTermsGuid],
		[DownloadsAllowed],
		[ExpireAfterDays],
		[CountAfterDownload],
		[PurchaseTime],
		[DownloadedCount]
		
FROM
		[dbo].[ws_FullfillDownloadTicket]
		
WHERE
		[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_FullfillDownloadTicket_SelectPageByStore] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket_SelectPageByStore]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadTicket_SelectPageByStore]

-- Author:   			Joe Audette
-- Created: 			3/25/2007
-- Last Modified: 		3/25/2007


@StoreGuid uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS

DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
Guid
)

SELECT
		[Guid]
		
FROM
		[dbo].[ws_FullfillDownloadTicket]
		
WHERE
		[StoreGuid] = @StoreGuid

ORDER BY 
		[PurchaseTime] DESC
END

DECLARE @TotalRows int
DECLARE @TotalPages int
DECLARE @Remainder int

SET @TotalRows = (SELECT Count(*) FROM #PageIndex)
SET @TotalPages = @TotalRows / @PageSize
SET @Remainder = @TotalRows % @PageSize
IF @Remainder > 0 
SET @TotalPages = @TotalPages + 1


SELECT
		t1.*,
		@TotalPages AS TotalPages
		
FROM
		[dbo].[ws_FullfillDownloadTicket] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]
		
WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_FullfillDownloadTicket_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_FullfillDownloadTicket_Update]

/*
Author:   			Joe Audette
Created: 			3/25/2007
Last Modified: 		3/25/2007
*/
	
@Guid uniqueidentifier, 
@ProductGuid uniqueidentifier, 
@FullfillTermsGuid uniqueidentifier, 
@DownloadsAllowed int, 
@ExpireAfterDays int, 
@CountAfterDownload bit, 
@PurchaseTime datetime, 
@DownloadedCount int 


AS

UPDATE 		[dbo].[ws_FullfillDownloadTicket] 

SET
			[ProductGuid] = @ProductGuid,
			[FullfillTermsGuid] = @FullfillTermsGuid,
			[DownloadsAllowed] = @DownloadsAllowed,
			[ExpireAfterDays] = @ExpireAfterDays,
			[CountAfterDownload] = @CountAfterDownload,
			[PurchaseTime] = @PurchaseTime,
			[DownloadedCount] = @DownloadedCount
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Offer_Delete]

/*
Author:   			Joe Audette
Created: 			2/28/2007
Last Modified: 		2/28/2007
*/
	
@Guid uniqueidentifier, 
@IsDeleted bit,
@DeletedTime datetime, 
@DeletedBy uniqueidentifier, 
@DeletedFromIP nvarchar(255)



AS
UPDATE 		[dbo].[ws_Offer] 

SET
			[IsDeleted] = @IsDeleted,
			[DeletedTime] = @DeletedTime,
			[DeletedBy] = @DeletedBy,
			[DeletedFromIP] = @DeletedFromIP
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_GetByProduct]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Offer_GetByProduct]

-- Author:   			Joe Audette
-- Created: 			2008-10-22
-- Last Modified: 		2009-06-26

@ProductGuid		uniqueidentifier

AS

SELECT 
o.*,
op.ProductGuid

FROM	ws_Offer o

JOIN ws_OfferProduct op
ON o.Guid = op.OfferGuid

WHERE 
op.ProductGuid = @ProductGuid
AND o.IsVisible = 1
AND o.IsDeleted = 0
AND op.IsDeleted = 0


ORDER BY o.SortRank1, o.SortRank2, o.Price


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_GetCount]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].ws_Offer_GetCount

/*
Author:   			Joe Audette
Created: 			2008-07-16
Last Modified: 		2008-07-16
*/

@StoreGuid uniqueidentifier

AS

SELECT COUNT(*) 
FROM [dbo].[ws_Offer]
WHERE [StoreGuid] = @StoreGuid
AND [IsDeleted] = 0

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_GetCountForProductList]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Offer_GetCountForProductList]

/*
Author:   			Joe Audette
Created: 			2008-07-16
Last Modified: 		2008-07-16
*/

@StoreGuid uniqueidentifier

AS

SELECT COUNT(*) 
FROM [dbo].[ws_Offer]
WHERE [StoreGuid] = @StoreGuid
AND [IsDeleted] = 0
AND [IsVisible] = 1

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_GetListForPageOfProducts]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Offer_GetListForPageOfProducts]

-- Author:   			Joe Audette
-- Created: 			2008-10-20
-- Last Modified: 		2009-06-16

@StoreGuid		uniqueidentifier,
@PageNumber 	int,
@PageSize 		int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
Guid
)

SELECT
		p.[Guid]
		
FROM
		[dbo].[ws_Product] p
		
WHERE
		p.StoreGuid = @StoreGuid
		AND p.[IsDeleted] = 0
		AND p.[ShowInProductList] = 1

ORDER BY
		p.[Name]

END

SELECT 
o.*,
op.ProductGuid

FROM	ws_Offer o

JOIN ws_OfferProduct op
ON o.Guid = op.OfferGuid

WHERE 
o.StoreGuid = @StoreGuid
AND o.IsVisible = 1
AND o.IsDeleted = 0
AND op.IsDeleted = 0
AND op.ProductGuid IN
(SELECT
		t1.Guid
		
FROM
		[dbo].[ws_Product] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]

WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
)

ORDER BY o.SortRank1, o.SortRank2, o.Price

DROP TABLE #PageIndex


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Offer_Insert]

/*
Author:   			Joe Audette
Created: 			2007-02-27
Last Modified: 		2009-01-26
*/

@Guid uniqueidentifier,
@StoreGuid uniqueidentifier,
@IsVisible bit,
@IsSpecial bit,
@TaxClassGuid uniqueidentifier,
@Url nvarchar(255),
@Created datetime,
@CreatedBy uniqueidentifier,
@CreatedFromIP nvarchar(255),
@LastModified datetime,
@LastModifiedBy uniqueidentifier,
@LastModifiedFromIP nvarchar(255),
@IsDonation bit,
@Name nvarchar(255),
@Description nvarchar(max),
@Abstract nvarchar(max),
@Price decimal(15,4),
@ProductListName nvarchar(255),
@ShowDetailLink bit,
@UserCanSetPrice bit,
@MaxPerOrder int,
@SortRank1 int,
@SortRank2 int

	
AS
INSERT INTO 	[dbo].[ws_Offer] 
(
				[Guid],
				[StoreGuid],
				[IsVisible],
				[IsSpecial],
				[Created],
				[CreatedBy],
				[CreatedFromIP],
				[LastModified],
				[LastModifiedBy],
				[LastModifiedFromIP],
				[TaxClassGuid],
				[Url],
				[IsDonation],
				[Name],
				[Description],
				[Abstract],
				[Price],
				[ProductListName],
				[ShowDetailLink],
				[UserCanSetPrice],
				[MaxPerOrder],
				[SortRank1],
				[SortRank2]
) 

VALUES 
(
				@Guid,
				@StoreGuid,
				@IsVisible,
				@IsSpecial,
				@Created,
				@CreatedBy,
				@CreatedFromIP,
				@LastModified,
				@LastModifiedBy,
				@LastModifiedFromIP,
				@TaxClassGuid,
				@Url,
				@IsDonation,
				@Name,
				@Description,
				@Abstract,
				@Price,
				@ProductListName,
				@ShowDetailLink,
				@UserCanSetPrice,
				@MaxPerOrder,
				@SortRank1,
				@SortRank2
				
)


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Offer_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-02-28
Last Modified: 		2008-10-16
*/

@Guid uniqueidentifier

AS

SELECT *

		
FROM
		[dbo].[ws_Offer]
		
WHERE
		[Guid] = @Guid
		

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_Offer_SelectPage] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_SelectPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Offer_SelectPage]

-- Author:   			Joe Audette
-- Created: 			2007-02-28
-- Last Modified: 		2008-10-16

@StoreGuid uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
Guid
)

SELECT
		o.[Guid]
		
FROM
		[dbo].[ws_Offer] o

		
WHERE  o.[StoreGuid] = @StoreGuid
		AND o.[IsDeleted] = 0

ORDER BY o.[Name]

END

DECLARE @TotalRows int
DECLARE @TotalPages int
DECLARE @Remainder int

SET @TotalRows = (SELECT Count(*) FROM #PageIndex)
SET @TotalPages = @TotalRows / @PageSize
SET @Remainder = @TotalRows % @PageSize
IF @Remainder > 0 
SET @TotalPages = @TotalPages + 1


SELECT
		t1.*,
		@TotalPages AS TotalPages
		
FROM
		[dbo].[ws_Offer] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]

WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_SelectPageForProductList]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Offer_SelectPageForProductList]

-- Author:   			Joe Audette
-- Created: 			2008-07-16
-- Last Modified: 		2008-10-16

@StoreGuid uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
Guid
)

SELECT
		o.[Guid]
		
FROM
		[dbo].[ws_Offer] o
	
WHERE  o.[StoreGuid] = @StoreGuid
		AND o.[IsDeleted] = 0
		AND o.[IsVisible] = 1

ORDER BY o.[Name]

END

SELECT
		t1.*
		
FROM
		[dbo].[ws_Offer] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]

		
WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_SelectPublicPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Offer_SelectPublicPage]

-- Author:   			Joe Audette
-- Created: 			2009-07-04
-- Last Modified: 		2009-07-04

@StoreGuid uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
Guid
)

SELECT
		o.[Guid]
		
FROM
		[dbo].[ws_Offer] o

		
WHERE  o.[StoreGuid] = @StoreGuid
		AND o.[IsDeleted] = 0
		AND o.IsVisible = 1

ORDER BY o.SortRank1, o.SortRank2, o.[Name]

END




SELECT
		t1.*
FROM
		[dbo].[ws_Offer] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]

WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_SelectTop10Specials]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Offer_SelectTop10Specials]

/*
Author:   			Joe Audette
Created: 			2007-03-05
Last Modified: 		2009-01-26
*/

@StoreGuid uniqueidentifier


AS
SELECT TOP 10
		o.*

		
FROM
		[dbo].[ws_Offer] o
	
WHERE
		o.[StoreGuid] = @StoreGuid
		AND o.[IsDeleted] = 0
		AND o.[IsVisible] = 1
		AND o.[IsSpecial] = 1

ORDER BY o.SortRank1, o.SortRank2, o.[Name]

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Offer_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Offer_Update]

/*
Author:   			Joe Audette
Created: 			2007-02-28
Last Modified: 		2009-01-26
*/
	
@Guid uniqueidentifier, 
@IsVisible bit, 
@IsSpecial bit, 
@TaxClassGuid uniqueidentifier,
@Url nvarchar(255),
@LastModified datetime, 
@LastModifiedBy uniqueidentifier, 
@LastModifiedFromIP nvarchar(255),
@IsDonation bit,
@Name nvarchar(255),
@Description nvarchar(max),
@Abstract nvarchar(max),
@Price decimal(15,4),
@ProductListName nvarchar(255),
@ShowDetailLink bit,
@UserCanSetPrice bit,
@MaxPerOrder int,
@SortRank1 int,
@SortRank2 int


AS
UPDATE 		[dbo].[ws_Offer] 

SET
			
			[IsVisible] = @IsVisible,
			[IsSpecial] = @IsSpecial,
			[LastModified] = @LastModified,
			[LastModifiedBy] = @LastModifiedBy,
			[LastModifiedFromIP] = @LastModifiedFromIP,
			[TaxClassGuid] = @TaxClassGuid,
			[Url] = @Url,
			[IsDonation] = @IsDonation,
			[Name] = @Name,
			[Description] = @Description,
			[Abstract] = @Abstract,
			[Price] = @Price,
			[ProductListName] = @ProductListName,
			[ShowDetailLink] = @ShowDetailLink,
			[UserCanSetPrice] = @UserCanSetPrice,
			[MaxPerOrder] = @MaxPerOrder,
			[SortRank1] = @SortRank1,
			[SortRank2] = @SortRank2
			
WHERE
			[Guid] = @Guid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferAvailability_Delete]

/*
Author:   			Joe Audette
Created: 			3/1/2007
Last Modified: 		3/1/2007
*/
	
@Guid uniqueidentifier, 
@IsDeleted bit, 
@DeletedBy uniqueidentifier, 
@DeletedTime datetime, 
@DeletedFromIP nvarchar(255)


AS

UPDATE 		[dbo].[ws_OfferAvailability] 

SET
			
			[IsDeleted] = @IsDeleted,
			[DeletedBy] = @DeletedBy,
			[DeletedTime] = @DeletedTime,
			[DeletedFromIP] = @DeletedFromIP
			
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferAvailability_Insert]

/*
Author:   			Joe Audette
Created: 			3/1/2007
Last Modified: 		3/1/2007
*/

@Guid uniqueidentifier,
@OfferGuid uniqueidentifier,
@BeginUTC datetime,
@EndUTC datetime,
@RequiresOfferCode bit,
@OfferCode nvarchar(50),
@MaxAllowedPerCustomer int,
@Created datetime,
@CreatedBy uniqueidentifier,
@CreatedFromIP nvarchar(255),
@LastModified datetime,
@LastModifedBy uniqueidentifier,
@LastModifedFromIP nvarchar(255)

	
AS

INSERT INTO 	[dbo].[ws_OfferAvailability] 
(
				[Guid],
				[OfferGuid],
				[BeginUTC],
				[EndUTC],
				[RequiresOfferCode],
				[OfferCode],
				[MaxAllowedPerCustomer],
				[Created],
				[CreatedBy],
				[CreatedFromIP],
				[IsDeleted],
				[LastModified],
				[LastModifedBy],
				[LastModifedFromIP]
) 

VALUES 
(
				@Guid,
				@OfferGuid,
				@BeginUTC,
				@EndUTC,
				@RequiresOfferCode,
				@OfferCode,
				@MaxAllowedPerCustomer,
				@Created,
				@CreatedBy,
				@CreatedFromIP,
				0,
				@LastModified,
				@LastModifedBy,
				@LastModifedFromIP
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability_SelectByOffer]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferAvailability_SelectByOffer]

/*
Author:   			Joe Audette
Created: 			3/1/2007
Last Modified: 		3/1/2007
*/

@OfferGuid uniqueidentifier

AS
SELECT
		[Guid],
		[OfferGuid],
		[BeginUTC],
		[EndUTC],
		[RequiresOfferCode],
		[OfferCode],
		[MaxAllowedPerCustomer],
		[Created],
		[CreatedBy],
		[CreatedFromIP],
		[IsDeleted],
		[DeletedBy],
		[DeletedTime],
		[DeletedFromIP],
		[LastModified],
		[LastModifedBy],
		[LastModifedFromIP]
		
FROM
		[dbo].[ws_OfferAvailability]
		
WHERE
		[OfferGuid] = @OfferGuid
		AND [IsDeleted] = 0

ORDER BY
		[BeginUTC]
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferAvailability_SelectOne]

/*
Author:   			Joe Audette
Created: 			3/1/2007
Last Modified: 		3/1/2007
*/

@Guid uniqueidentifier

AS


SELECT
		[Guid],
		[OfferGuid],
		[BeginUTC],
		[EndUTC],
		[RequiresOfferCode],
		[OfferCode],
		[MaxAllowedPerCustomer],
		[Created],
		[CreatedBy],
		[CreatedFromIP],
		[IsDeleted],
		[DeletedBy],
		[DeletedTime],
		[DeletedFromIP],
		[LastModified],
		[LastModifedBy],
		[LastModifedFromIP]
		
FROM
		[dbo].[ws_OfferAvailability]
		
WHERE
		[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailability_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferAvailability_Update]

/*
Author:   			Joe Audette
Created: 			3/1/2007
Last Modified: 		3/1/2007
*/
	
@Guid uniqueidentifier, 
@BeginUTC datetime, 
@EndUTC datetime, 
@RequiresOfferCode bit, 
@OfferCode nvarchar(50), 
@MaxAllowedPerCustomer int, 
@LastModified datetime, 
@LastModifedBy uniqueidentifier, 
@LastModifedFromIP nvarchar(255) 


AS

UPDATE 		[dbo].[ws_OfferAvailability] 

SET
			
			[BeginUTC] = @BeginUTC,
			[EndUTC] = @EndUTC,
			[RequiresOfferCode] = @RequiresOfferCode,
			[OfferCode] = @OfferCode,
			[MaxAllowedPerCustomer] = @MaxAllowedPerCustomer,
			[LastModified] = @LastModified,
			[LastModifedBy] = @LastModifedBy,
			[LastModifedFromIP] = @LastModifedFromIP
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferAvailabilityHistory_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferAvailabilityHistory_Insert]

/*
Author:   			Joe Audette
Created: 			3/1/2007
Last Modified: 		3/1/2007
*/

@Guid uniqueidentifier,
@AvailabilityGuid uniqueidentifier,
@OfferGuid uniqueidentifier,
@BeginUTC datetime,
@EndUTC datetime,
@RequiresOfferCode bit,
@OfferCode nvarchar(50),
@MaxAllowedPerCustomer int,
@Created datetime,
@CreatedBy uniqueidentifier,
@CreatedFromIP nvarchar(255),
@IsDeleted bit,
@DeletedBy uniqueidentifier,
@DeletedTime datetime,
@DeletedFromIP nvarchar(255),
@LastModified datetime,
@LastModifedBy uniqueidentifier,
@LastModifedFromIP nvarchar(255),
@LogTime datetime

	
AS

INSERT INTO 	[dbo].[ws_OfferAvailabilityHistory] 
(
				[Guid],
				[AvailabilityGuid],
				[OfferGuid],
				[BeginUTC],
				[EndUTC],
				[RequiresOfferCode],
				[OfferCode],
				[MaxAllowedPerCustomer],
				[Created],
				[CreatedBy],
				[CreatedFromIP],
				[IsDeleted],
				[DeletedBy],
				[DeletedTime],
				[DeletedFromIP],
				[LastModified],
				[LastModifedBy],
				[LastModifedFromIP],
				[LogTime]
) 

VALUES 
(
				@Guid,
				@AvailabilityGuid,
				@OfferGuid,
				@BeginUTC,
				@EndUTC,
				@RequiresOfferCode,
				@OfferCode,
				@MaxAllowedPerCustomer,
				@Created,
				@CreatedBy,
				@CreatedFromIP,
				@IsDeleted,
				@DeletedBy,
				@DeletedTime,
				@DeletedFromIP,
				@LastModified,
				@LastModifedBy,
				@LastModifedFromIP,
				@LogTime
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferHistory_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OfferHistory_Insert]

/*
Author:   			Joe Audette
Created: 			2007-02-28
Last Modified: 		2008-07-16
*/

@Guid uniqueidentifier,
@OfferGuid uniqueidentifier,
@StoreGuid uniqueidentifier,
@IsVisible bit,
@IsSpecial bit,
@Created datetime,
@CreatedBy uniqueidentifier,
@CreatedFromIP nvarchar(255),
@IsDeleted bit,
@DeletedTime datetime,
@DeletedBy uniqueidentifier,
@DeletedFromIP nvarchar(255),
@LastModified datetime,
@LastModifiedBy uniqueidentifier,
@LastModifiedFromIP nvarchar(255),
@LogTime datetime,
@TaxClassGuid uniqueidentifier,
@Url nvarchar(255)

	
AS
INSERT INTO 	[dbo].[ws_OfferHistory] 
(
				[Guid],
				[OfferGuid],
				[StoreGuid],
				[TaxClassGuid],
				[IsVisible],
				[IsSpecial],
				[Created],
				[CreatedBy],
				[CreatedFromIP],
				[IsDeleted],
				[DeletedTime],
				[DeletedBy],
				[DeletedFromIP],
				[LastModified],
				[LastModifiedBy],
				[LastModifiedFromIP],
				[LogTime],
				[Url]
) 

VALUES 
(
				@Guid,
				@OfferGuid,
				@StoreGuid,
				@TaxClassGuid,
				@IsVisible,
				@IsSpecial,
				@Created,
				@CreatedBy,
				@CreatedFromIP,
				@IsDeleted,
				@DeletedTime,
				@DeletedBy,
				@DeletedFromIP,
				@LastModified,
				@LastModifiedBy,
				@LastModifiedFromIP,
				@LogTime,
				@Url
				
)


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferPriceHistory_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferPriceHistory_Insert]

/*
Author:   			Joe Audette
Created: 			3/3/2007
Last Modified: 		3/3/2007
*/

@Guid uniqueidentifier,
@PriceGuid uniqueidentifier,
@OfferGuid uniqueidentifier,
@CurrencyGuid uniqueidentifier,
@Price decimal(15, 4),
@Created datetime,
@CreatedBy uniqueidentifier,
@CreatedFromIP nvarchar(255),
@LastModifed datetime,
@LastModifiedBy uniqueidentifier,
@ModifiedFromIP nvarchar(255),
@LogTime datetime

	
AS
INSERT INTO 	[dbo].[ws_OfferPriceHistory] 
(
				[Guid],
				[PriceGuid],
				[OfferGuid],
				[CurrencyGuid],
				[Price],
				[Created],
				[CreatedBy],
				[CreatedFromIP],
				[LastModifed],
				[LastModifiedBy],
				[ModifiedFromIP],
				[LogTime]
) 

VALUES 
(
				@Guid,
				@PriceGuid,
				@OfferGuid,
				@CurrencyGuid,
				@Price,
				@Created,
				@CreatedBy,
				@CreatedFromIP,
				@LastModifed,
				@LastModifiedBy,
				@ModifiedFromIP,
				@LogTime
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct_CountByOffer]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OfferProduct_CountByOffer]

/*
Author:   			Joe Audette
Created: 			2008-07-16
Last Modified: 		2008-07-16
*/

@OfferGuid uniqueidentifier

AS


SELECT
		Count(*)
			
		
FROM
		[dbo].[ws_OfferProduct] 


WHERE
		[OfferGuid] = @OfferGuid
		AND [IsDeleted] = 0

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferProduct_Delete]

/*
Author:   			Joe Audette
Created: 			3/2/2007
Last Modified: 		3/2/2007
*/
	
@Guid uniqueidentifier, 
@DeletedBy uniqueidentifier, 
@DeletedFromIP nvarchar(255), 
@DeletedTime datetime



AS

UPDATE 		[dbo].[ws_OfferProduct] 

SET
			[IsDeleted] = 1,
			[DeletedBy] = @DeletedBy,
			[DeletedFromIP] = @DeletedFromIP,
			[DeletedTime] = @DeletedTime
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct_DeleteByProduct]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferProduct_DeleteByProduct]

/*
Author:   			Joe Audette
Created: 			3/2/2007
Last Modified: 		3/2/2007
*/
	
@ProductGuid uniqueidentifier, 
@DeletedBy uniqueidentifier, 
@DeletedFromIP nvarchar(255), 
@DeletedTime datetime



AS
UPDATE 		[dbo].[ws_OfferProduct] 

SET
			[IsDeleted] = 1,
			[DeletedBy] = @DeletedBy,
			[DeletedFromIP] = @DeletedFromIP,
			[DeletedTime] = @DeletedTime
			
WHERE
			[ProductGuid] = @ProductGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferProduct_Insert]

/*
Author:   			Joe Audette
Created: 			3/2/2007
Last Modified: 		3/2/2007
*/

@Guid uniqueidentifier,
@OfferGuid uniqueidentifier,
@ProductGuid uniqueidentifier,
@FullfillType tinyint,
@FullFillTermsGuid uniqueidentifier,
@Quantity int,
@SortOrder int,
@Created datetime,
@CreatedBy uniqueidentifier,
@CreatedFromIP nvarchar(255),
@LastModified datetime,
@LastModifiedBy uniqueidentifier,
@LastModifiedFromIP nvarchar(255)

	
AS
INSERT INTO 	[dbo].[ws_OfferProduct] 
(
				[Guid],
				[OfferGuid],
				[ProductGuid],
				[FullfillType],
				[FullFillTermsGuid],
				[Quantity],
				[SortOrder],
				[IsDeleted],
				[Created],
				[CreatedBy],
				[CreatedFromIP],
				[LastModified],
				[LastModifiedBy],
				[LastModifiedFromIP]
) 

VALUES 
(
				@Guid,
				@OfferGuid,
				@ProductGuid,
				@FullfillType,
				@FullFillTermsGuid,
				@Quantity,
				@SortOrder,
				0,
				@Created,
				@CreatedBy,
				@CreatedFromIP,
				@LastModified,
				@LastModifiedBy,
				@LastModifiedFromIP
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct_SelectByOffer]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_OfferProduct_SelectByOffer]

/*
Author:   			Joe Audette
Created: 			2007-03-02
Last Modified: 		2009-07-04
*/

@OfferGuid uniqueidentifier

AS


SELECT
		op.[Guid],
		op.[OfferGuid],
		op.[ProductGuid],
		op.[FullfillType],
		op.[FullFillTermsGuid],
		op.[Quantity],
		op.[SortOrder],
		p.[Name],
		p.[Description],
		p.[Abstract],
		p.TeaserFile,
		p.TeaserFileLink
			
		
FROM
		[dbo].[ws_OfferProduct] op

JOIN
		[dbo].[ws_Product] p

ON		op.ProductGuid = p.Guid

		
WHERE
		op.[OfferGuid] = @OfferGuid
		AND op.[IsDeleted] = 0

ORDER BY
		op.[SortOrder]

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferProduct_SelectOne]

/*
Author:   			Joe Audette
Created: 			3/2/2007
Last Modified: 		3/2/2007
*/

@Guid uniqueidentifier

AS


SELECT
		[Guid],
		[OfferGuid],
		[ProductGuid],
		[FullfillType],
		[FullFillTermsGuid],
		[Quantity],
		[SortOrder],
		[IsDeleted],
		[Created],
		[CreatedBy],
		[CreatedFromIP],
		[DeletedBy],
		[DeletedFromIP],
		[DeletedTime],
		[LastModified],
		[LastModifiedBy],
		[LastModifiedFromIP]
		
FROM
		[dbo].[ws_OfferProduct]
		
WHERE
		[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OfferProduct_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OfferProduct_Update]

/*
Author:   			Joe Audette
Created: 			3/2/2007
Last Modified: 		3/2/2007
*/
	
@Guid uniqueidentifier,  
@FullfillType tinyint, 
@FullFillTermsGuid uniqueidentifier, 
@Quantity int, 
@SortOrder int, 
@LastModified datetime, 
@LastModifiedBy uniqueidentifier, 
@LastModifiedFromIP nvarchar(255) 


AS

UPDATE 		[dbo].[ws_OfferProduct] 

SET
			
			[FullfillType] = @FullfillType,
			[FullFillTermsGuid] = @FullFillTermsGuid,
			[Quantity] = @Quantity,
			[SortOrder] = @SortOrder,
			[LastModified] = @LastModified,
			[LastModifiedBy] = @LastModifiedBy,
			[LastModifiedFromIP] = @LastModifiedFromIP
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Order_Delete]

/*
Author:   			Joe Audette
Created: 			3/17/2007
Last Modified: 		3/17/2007
*/

@OrderGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_Order]
WHERE
	[OrderGuid] = @OrderGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_Order_EnsureReportData] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_EnsureReportData]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[ws_Order_EnsureReportData]
/*
Author:   			Joe Audette
Created: 			2009-01-31
Last Modified: 		2009-01-31
*/
@ModuleGuid uniqueidentifier,
@PageID int

AS

INSERT INTO [dbo].[mp_CommerceReport]
(RowGuid,SiteGuid,UserGuid,FeatureGuid,ModuleGuid,ModuleTitle,OrderGuid,ItemGuid,ItemName,
Quantity,Price,SubTotal,OrderDateUtc,PaymentMethod,IPAddress,AdminOrderLink,
UserOrderLink,RowCreatedUtc)

SELECT
oo.ItemGuid AS RowGuid,
s.SiteGuid,
o.UserGuid,
m.FeatureGuid,
m.[Guid] AS ModuleGuid,
m.ModuleTitle,
o.OrderGuid,
oo.OfferGuid AS ItemGuid,
p.[Name] AS ItemName,
oo.Quantity,
oo.OfferPrice AS Price,
(oo.Quantity * oo.OfferPrice) AS SubTotal,
o.Created AS OrderDateUtc,
o.PaymentMethod,
o.CreatedFromIP AS IPAddress,
''/WebStore/AdminOrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS AdminOrderLink,
''/WebStore/OrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS UserOrderLink,
GetUtcDate() As RowCreatedUtc

FROM
[dbo].[ws_Store] s

JOIN
[dbo].[mp_Modules] m
ON s.ModuleID = m.ModuleID

JOIN
[dbo].[ws_Order] o
ON s.Guid = o.StoreGuid

JOIN
[dbo].[ws_OrderOffers] oo
ON oo.OrderGuid = o.OrderGuid

JOIN
[dbo].[ws_Offer] p
ON oo.OfferGuid = p.[Guid]

LEFT OUTER JOIN
[dbo].mp_CommerceReport cr
ON
cr.RowGuid = oo.ItemGuid

WHERE
cr.RowGuid IS NULL
AND m.[Guid] = @ModuleGuid
AND o.OrderTotal > 0



' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_Order_EnsureReportDataForOrder] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_EnsureReportDataForOrder]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE PROCEDURE [dbo].[ws_Order_EnsureReportDataForOrder]
/*
Author:   			Joe Audette
Created: 			2009-02-14
Last Modified: 		2009-09-04
*/

@OrderGuid uniqueidentifier,
@ModuleGuid uniqueidentifier,
@PageID int

AS

INSERT INTO [dbo].[mp_CommerceReport]
(RowGuid,SiteGuid,UserGuid,FeatureGuid,ModuleGuid,ModuleTitle,OrderGuid,ItemGuid,ItemName,
Quantity,Price,SubTotal,OrderDateUtc,PaymentMethod,IPAddress,AdminOrderLink,
UserOrderLink,RowCreatedUtc)

SELECT
oo.ItemGuid AS RowGuid,
s.SiteGuid,
o.UserGuid,
m.FeatureGuid,
m.[Guid] AS ModuleGuid,
m.ModuleTitle,
o.OrderGuid,
oo.OfferGuid AS ItemGuid,
p.[Name] AS ItemName,
oo.Quantity,
oo.OfferPrice AS Price,
(oo.Quantity * oo.OfferPrice) AS SubTotal,
o.Created AS OrderDateUtc,
o.PaymentMethod,
o.CreatedFromIP AS IPAddress,
''/WebStore/AdminOrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS AdminOrderLink,
''/WebStore/OrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS UserOrderLink,
GetUtcDate() As RowCreatedUtc

FROM
[dbo].[ws_Store] s

JOIN
[dbo].[mp_Modules] m
ON s.ModuleID = m.ModuleID

JOIN
[dbo].[ws_Order] o
ON s.Guid = o.StoreGuid

JOIN
[dbo].[ws_OrderOffers] oo
ON oo.OrderGuid = o.OrderGuid

JOIN
[dbo].[ws_Offer] p
ON oo.OfferGuid = p.[Guid]

LEFT OUTER JOIN
[dbo].mp_CommerceReport cr
ON
cr.RowGuid = oo.ItemGuid

WHERE
o.OrderGuid = @OrderGuid
AND cr.RowGuid IS NULL
AND m.[Guid] = @ModuleGuid
AND o.OrderTotal > 0


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_Order_EnsureReportOrderData] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_EnsureReportOrderData]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[ws_Order_EnsureReportOrderData]
/*
Author:   			Joe Audette
Created: 			2009-02-18
Last Modified: 		2009-02-18
*/
@ModuleGuid uniqueidentifier,
@PageID int

AS

INSERT INTO [dbo].[mp_CommerceReportOrders]
(
RowGuid,
SiteGuid,
FeatureGuid,
ModuleGuid,
UserGuid,
OrderGuid,
BillingFirstName,
BillingLastName,
BillingCompany,
BillingAddress1,
BillingAddress2,
BillingSuburb,
BillingCity,
BillingPostalCode,
BillingState,
BillingCountry,
PaymentMethod,
SubTotal,
TaxTotal,
ShippingTotal,
OrderTotal,
OrderDateUtc,
AdminOrderLink,
UserOrderLink,
RowCreatedUtc
)

SELECT
o.OrderGuid AS RowGuid,
s.SiteGuid,
m.FeatureGuid,
m.[Guid] AS ModuleGuid,
o.UserGuid,
o.OrderGuid,
o.BillingFirstName,
o.BillingLastName,
o.BillingCompany,
o.BillingAddress1,
o.BillingAddress2,
o.BillingSuburb,
o.BillingCity,
o.BillingPostalCode,
o.BillingState,
o.BillingCountry,
o.PaymentMethod,
o.SubTotal,
o.TaxTotal,
o.ShippingTotal,
o.OrderTotal,
o.LastModified,
''/WebStore/AdminOrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS AdminOrderLink,
''/WebStore/OrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS UserOrderLink,
GetUtcDate() As RowCreatedUtc

FROM
[dbo].[ws_Store] s

JOIN
[dbo].[mp_Modules] m
ON s.ModuleID = m.ModuleID

JOIN
[dbo].[ws_Order] o
ON s.Guid = o.StoreGuid


LEFT OUTER JOIN
[dbo].mp_CommerceReportOrders cr
ON
cr.RowGuid = o.OrderGuid

WHERE
cr.RowGuid IS NULL
AND m.[Guid] = @ModuleGuid
AND o.OrderTotal > 0


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_Order_EnsureReportOrderDataForOrder] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_EnsureReportOrderDataForOrder]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[ws_Order_EnsureReportOrderDataForOrder]
/*
Author:   			Joe Audette
Created: 			2009-02-18
Last Modified: 		2009-02-18
*/

@OrderGuid uniqueidentifier,
@ModuleGuid uniqueidentifier,
@PageID int

AS

INSERT INTO [dbo].[mp_CommerceReportOrders]
(
RowGuid,
SiteGuid,
FeatureGuid,
ModuleGuid,
UserGuid,
OrderGuid,
BillingFirstName,
BillingLastName,
BillingCompany,
BillingAddress1,
BillingAddress2,
BillingSuburb,
BillingCity,
BillingPostalCode,
BillingState,
BillingCountry,
PaymentMethod,
SubTotal,
TaxTotal,
ShippingTotal,
OrderTotal,
OrderDateUtc,
AdminOrderLink,
UserOrderLink,
RowCreatedUtc)

SELECT
o.OrderGuid AS RowGuid,
s.SiteGuid,
m.FeatureGuid,
m.[Guid] AS ModuleGuid,
o.UserGuid,
o.OrderGuid,
o.BillingFirstName,
o.BillingLastName,
o.BillingCompany,
o.BillingAddress1,
o.BillingAddress2,
o.BillingSuburb,
o.BillingCity,
o.BillingPostalCode,
o.BillingState,
o.BillingCountry,
o.PaymentMethod,
o.SubTotal,
o.TaxTotal,
o.ShippingTotal,
o.OrderTotal,
o.LastModified,
''/WebStore/AdminOrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS AdminOrderLink,
''/WebStore/OrderDetail.aspx?pageid='' 
				+ Convert(varchar(20), @PageID)
				+ ''&amp;mid='' + Convert(varchar(20), m.ModuleID)
				+ ''&amp;order='' + CONVERT(varchar(36), o.OrderGuid) AS UserOrderLink,
GetUtcDate() As RowCreatedUtc

FROM
[dbo].[ws_Store] s

JOIN
[dbo].[mp_Modules] m
ON s.ModuleID = m.ModuleID

JOIN
[dbo].[ws_Order] o
ON s.Guid = o.StoreGuid


LEFT OUTER JOIN
[dbo].mp_CommerceReportOrders cr
ON
cr.RowGuid = o.OrderGuid

WHERE
o.OrderGuid = @OrderGuid
AND cr.RowGuid IS NULL
AND m.[Guid] = @ModuleGuid
AND o.OrderTotal > 0



' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_GetAllTimeRevenue]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Order_GetAllTimeRevenue]

/*
Author:   			Joe Audette
Created: 			2008-12-18
Last Modified: 		2008-12-18
*/

@StoreGuid uniqueidentifier

AS


SELECT 
SUM(oo.OfferPrice) 
		
FROM
		[dbo].[ws_OrderOffers] oo
JOIN	[dbo].[ws_Offer] o
ON o.Guid = oo.OfferGuid
		
WHERE
		o.[StoreGuid] = @StoreGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_GetCount]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].ws_Order_GetCount

/*
Author:   			Joe Audette
Created: 			2008-4-6
Last Modified: 		2008-4-6
*/

@StoreGuid uniqueidentifier
AS

SELECT COUNT(*) 
FROM [dbo].[ws_Order]
WHERE StoreGuid = @StoreGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_GetRevenueSummary]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Order_GetRevenueSummary]

/*
Author:   			Joe Audette
Created: 			2008-12-18
Last Modified: 		2008-12-18
*/

@StoreGuid uniqueidentifier

AS


SELECT 
o.Name,
oo.OfferGuid,
COUNT(*) AS UnitsSold,
SUM(oo.OfferPrice) AS Revenue
		
FROM
		[dbo].[ws_OrderOffers] oo
JOIN	[dbo].[ws_Offer] o
ON o.Guid = oo.OfferGuid
		
WHERE
		o.[StoreGuid] = @StoreGuid

GROUP BY o.Name, oo.OfferGuid
ORDER BY SUM(oo.OfferPrice) DESC

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_GetSalesByYearMonth]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Order_GetSalesByYearMonth]

/*
Author:   			Joe Audette
Created: 			2008-12-18
Last Modified: 		2008-12-18
*/

@StoreGuid uniqueidentifier

AS


SELECT TOP 13
YEAR(Completed) As Y,
    MONTH(Completed) As M,
	SUM(OrderTotal) As Sales
		
FROM
		[dbo].[ws_Order]
		
WHERE
		[StoreGuid] = @StoreGuid

GROUP BY YEAR(Completed), MONTH(Completed)
ORDER BY YEAR(Completed) desc, MONTH(Completed) desc

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Order_Insert]

/*
Author:   			Joe Audette
Created: 			2007-03-17
Last Modified: 		2009-07-28
*/

@OrderGuid uniqueidentifier,
@OrderNo int,
@StoreGuid uniqueidentifier,
@UserGuid uniqueidentifier,
@CustomerFirstName nvarchar(100),
@CustomerLastName nvarchar(100),
@CustomerCompany nvarchar(255),
@CustomerAddressLine1 nvarchar(255),
@CustomerAddressLine2 nvarchar(255),
@CustomerSuburb nvarchar(255),
@CustomerCity nvarchar(255),
@CustomerPostalCode nvarchar(20),
@CustomerState nvarchar(255),
@CustomerCountry nvarchar(255),
@CustomerTelephoneDay nvarchar(32),
@CustomerTelephoneNight nvarchar(32),
@CustomerEmail nvarchar(96),
@CustomerEmailVerified bit,
@DeliveryFirstName nvarchar(100),
@DeliveryLastName nvarchar(100),
@DeliveryCompany nvarchar(255),
@DeliveryAddress1 nvarchar(255),
@DeliveryAddress2 nvarchar(255),
@DeliverySuburb nvarchar(255),
@DeliveryCity nvarchar(255),
@DeliveryPostalCode nvarchar(20),
@DeliveryState nvarchar(255),
@DeliveryCountry nvarchar(255),
@BillingFirstName nvarchar(100),
@BillingLastName nvarchar(100),
@BillingCompany nvarchar(255),
@BillingAddress1 nvarchar(255),
@BillingAddress2 nvarchar(255),
@BillingSuburb nvarchar(255),
@BillingCity nvarchar(255),
@BillingPostalCode nvarchar(20),
@BillingState nvarchar(255),
@BillingCountry nvarchar(255),
@CardTypeGuid uniqueidentifier,
@CardOwner nvarchar(100),
@CardNumber nvarchar(255),
@CardExpires nvarchar(6),
@CardSecurityCode nvarchar(50),
@SubTotal decimal(15, 4),
@TaxTotal decimal(15, 4),
@ShippingTotal decimal(15, 4),
@OrderTotal decimal(15, 4),
@Created datetime,
@CreatedFromIP nvarchar(255),
@Completed datetime,
@CompletedFromIP nvarchar(255),
@LastModified datetime,
@LastUserActivity datetime,
@StatusGuid uniqueidentifier,
@GatewayTransID nvarchar(255),
@GatewayRawResponse nvarchar(max),
@GatewayAuthCode nvarchar(50),
@TaxZoneGuid uniqueidentifier,
@CustomData nvarchar(max),
@DiscountCodesCsv nvarchar(max),
@Discount decimal(15,4),
@ClerkGuid uniqueidentifier

	
AS

INSERT INTO 	[dbo].[ws_Order] 
(
				[OrderGuid],
				--[OrderNo],
				[StoreGuid],
				[UserGuid],
				[CustomerFirstName],
				[CustomerLastName],
				[CustomerCompany],
				[CustomerAddressLine1],
				[CustomerAddressLine2],
				[CustomerSuburb],
				[CustomerCity],
				[CustomerPostalCode],
				[CustomerState],
				[CustomerCountry],
				[CustomerTelephoneDay],
				[CustomerTelephoneNight],
				[CustomerEmail],
				[CustomerEmailVerified],
				[DeliveryFirstName],
				[DeliveryLastName],
				[DeliveryCompany],
				[DeliveryAddress1],
				[DeliveryAddress2],
				[DeliverySuburb],
				[DeliveryCity],
				[DeliveryPostalCode],
				[DeliveryState],
				[DeliveryCountry],
				[BillingFirstName],
				[BillingLastName],
				[BillingCompany],
				[BillingAddress1],
				[BillingAddress2],
				[BillingSuburb],
				[BillingCity],
				[BillingPostalCode],
				[BillingState],
				[BillingCountry],
				[CardTypeGuid],
				[CardOwner],
				[CardNumber],
				[CardExpires],
				[CardSecurityCode],
				
				[SubTotal],
				[TaxTotal],
				[ShippingTotal],
				[OrderTotal],
				[Created],
				[CreatedFromIP],
				[Completed],
				[CompletedFromIP],
				[LastModified],
				[LastUserActivity],
				[StatusGuid],
				[GatewayTransID],
				[GatewayRawResponse],
				[GatewayAuthCode],
				[TaxZoneGuid],
				[AnalyticsTracked],
				CustomData,
				DiscountCodesCsv,
				Discount,
				ClerkGuid
) 

VALUES 
(
				@OrderGuid,
				-- @OrderNo,
				@StoreGuid,
				@UserGuid,
				@CustomerFirstName,
				@CustomerLastName,
				@CustomerCompany,
				@CustomerAddressLine1,
				@CustomerAddressLine2,
				@CustomerSuburb,
				@CustomerCity,
				@CustomerPostalCode,
				@CustomerState,
				@CustomerCountry,
				@CustomerTelephoneDay,
				@CustomerTelephoneNight,
				@CustomerEmail,
				@CustomerEmailVerified,
				@DeliveryFirstName,
				@DeliveryLastName,
				@DeliveryCompany,
				@DeliveryAddress1,
				@DeliveryAddress2,
				@DeliverySuburb,
				@DeliveryCity,
				@DeliveryPostalCode,
				@DeliveryState,
				@DeliveryCountry,
				@BillingFirstName,
				@BillingLastName,
				@BillingCompany,
				@BillingAddress1,
				@BillingAddress2,
				@BillingSuburb,
				@BillingCity,
				@BillingPostalCode,
				@BillingState,
				@BillingCountry,
				@CardTypeGuid,
				@CardOwner,
				@CardNumber,
				@CardExpires,
				@CardSecurityCode,
				
				@SubTotal,
				@TaxTotal,
				@ShippingTotal,
				@OrderTotal,
				@Created,
				@CreatedFromIP,
				@Completed,
				@CompletedFromIP,
				@LastModified,
				@LastUserActivity,
				@StatusGuid,
				@GatewayTransID,
				@GatewayRawResponse,
				@GatewayAuthCode,
				@TaxZoneGuid,
				0,
				@CustomData,
				@DiscountCodesCsv,
				@Discount,
				@ClerkGuid
				
)




' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_SelectByUser]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Order_SelectByUser]

/*
Author:   			Joe Audette
Created: 			2007-03-17
Last Modified: 		2008-07-10
*/

@StoreGuid uniqueidentifier,
@UserGuid uniqueidentifier

AS


SELECT *
		
FROM
		[dbo].[ws_Order]
		
WHERE
		[StoreGuid] = @StoreGuid
		AND [UserGuid] = @UserGuid

ORDER BY [Completed] desc

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Order_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-03-17
Last Modified: 		2008-07-10
*/

@OrderGuid uniqueidentifier

AS


SELECT *
		
FROM
		[dbo].[ws_Order]
		
WHERE
		[OrderGuid] = @OrderGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_Order_SelectPage] -- Deprecated feature 'String literals as column aliases' is not supported in this version of SQL Server. Change your ' to double quote.
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_SelectPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Order_SelectPage]

-- Author:   			Joe Audette
-- Created: 			3/17/2007
-- Last Modified: 		3/17/2007

@StoreGuid uniqueidentifier,
@PageNumber 			int,
@PageSize 			int

AS

DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
OrderGuid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
OrderGuid
)

SELECT
		[OrderGuid]
		
FROM
		[dbo].[ws_Order]
		
WHERE  [StoreGuid] = @StoreGuid

ORDER BY [Created] DESC

END

DECLARE @TotalRows int
DECLARE @TotalPages int
DECLARE @Remainder int

SET @TotalRows = (SELECT Count(*) FROM #PageIndex)
SET @TotalPages = @TotalRows / @PageSize
SET @Remainder = @TotalRows % @PageSize
IF @Remainder > 0 
SET @TotalPages = @TotalPages + 1


SELECT
		t1.*,
		@TotalPages As TotalPages
		
FROM
		[dbo].[ws_Order] t1

JOIN			#PageIndex t2
ON			
		t1.[OrderGuid] = t2.[OrderGuid]
		
WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_TrackAnalytics]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Order_TrackAnalytics]

/*
Author:   			Joe Audette
Created: 			2008-08-13
Last Modified: 		2008-08-13
*/

@OrderGuid uniqueidentifier

AS

UPDATE [dbo].[ws_Order]
SET AnalyticsTracked = 1
WHERE
	[OrderGuid] = @OrderGuid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Order_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Order_Update]

/*
Author:   			Joe Audette
Created: 			2007-03-17
Last Modified: 		2009-07-28
*/
	
@OrderGuid uniqueidentifier, 
@UserGuid uniqueidentifier, 
@CustomerFirstName nvarchar(100), 
@CustomerLastName nvarchar(100),
@CustomerCompany nvarchar(255), 
@CustomerAddressLine1 nvarchar(255), 
@CustomerAddressLine2 nvarchar(255), 
@CustomerSuburb nvarchar(255), 
@CustomerCity nvarchar(255), 
@CustomerPostalCode nvarchar(20), 
@CustomerState nvarchar(255), 
@CustomerCountry nvarchar(255), 
@CustomerTelephoneDay nvarchar(32), 
@CustomerTelephoneNight nvarchar(32), 
@CustomerEmail nvarchar(96), 
@CustomerEmailVerified bit, 
@DeliveryFirstName nvarchar(100),
@DeliveryLastName nvarchar(100), 
@DeliveryCompany nvarchar(255), 
@DeliveryAddress1 nvarchar(255), 
@DeliveryAddress2 nvarchar(255), 
@DeliverySuburb nvarchar(255), 
@DeliveryCity nvarchar(255), 
@DeliveryPostalCode nvarchar(20), 
@DeliveryState nvarchar(255), 
@DeliveryCountry nvarchar(255), 
@BillingFirstName nvarchar(100),
@BillingLastName nvarchar(100), 
@BillingCompany nvarchar(255), 
@BillingAddress1 nvarchar(255), 
@BillingAddress2 nvarchar(255), 
@BillingSuburb nvarchar(255), 
@BillingCity nvarchar(255), 
@BillingPostalCode nvarchar(20), 
@BillingState nvarchar(255), 
@BillingCountry nvarchar(255), 
@CardTypeGuid uniqueidentifier, 
@CardOwner nvarchar(100), 
@CardNumber nvarchar(255), 
@CardExpires nvarchar(6), 
@CardSecurityCode nvarchar(50), 
@SubTotal decimal(15, 4), 
@TaxTotal decimal(15, 4), 
@ShippingTotal decimal(15, 4),
@OrderTotal decimal(15, 4), 
@Completed datetime, 
@CompletedFromIP nvarchar(255), 
@LastModified datetime, 
@LastUserActivity datetime, 
@StatusGuid uniqueidentifier, 
@GatewayTransID nvarchar(255), 
@GatewayRawResponse nvarchar(max), 
@GatewayAuthCode nvarchar(50), 
@TaxZoneGuid uniqueidentifier,
@PaymentMethod nvarchar(50),
@CustomData nvarchar(max),
@DiscountCodesCsv nvarchar(max),
@Discount decimal(15,4),
@ClerkGuid uniqueidentifier


AS

UPDATE 		[dbo].[ws_Order] 

SET

			
			[UserGuid] = @UserGuid,
			[CustomerFirstName] = @CustomerFirstName,
			[CustomerLastName] = @CustomerLastName,
			[CustomerCompany] = @CustomerCompany,
			[CustomerAddressLine1] = @CustomerAddressLine1,
			[CustomerAddressLine2] = @CustomerAddressLine2,
			[CustomerSuburb] = @CustomerSuburb,
			[CustomerCity] = @CustomerCity,
			[CustomerPostalCode] = @CustomerPostalCode,
			[CustomerState] = @CustomerState,
			[CustomerCountry] = @CustomerCountry,
			[CustomerTelephoneDay] = @CustomerTelephoneDay,
			[CustomerTelephoneNight] = @CustomerTelephoneNight,
			[CustomerEmail] = @CustomerEmail,
			[CustomerEmailVerified] = @CustomerEmailVerified,
			[DeliveryFirstName] = @DeliveryFirstName,
			[DeliveryLastName] = @DeliveryLastName,
			[DeliveryCompany] = @DeliveryCompany,
			[DeliveryAddress1] = @DeliveryAddress1,
			[DeliveryAddress2] = @DeliveryAddress2,
			[DeliverySuburb] = @DeliverySuburb,
			[DeliveryCity] = @DeliveryCity,
			[DeliveryPostalCode] = @DeliveryPostalCode,
			[DeliveryState] = @DeliveryState,
			[DeliveryCountry] = @DeliveryCountry,
			[BillingFirstName] = @BillingFirstName,
			[BillingLastName] = @BillingLastName,
			[BillingCompany] = @BillingCompany,
			[BillingAddress1] = @BillingAddress1,
			[BillingAddress2] = @BillingAddress2,
			[BillingSuburb] = @BillingSuburb,
			[BillingCity] = @BillingCity,
			[BillingPostalCode] = @BillingPostalCode,
			[BillingState] = @BillingState,
			[BillingCountry] = @BillingCountry,
			[CardTypeGuid] = @CardTypeGuid,
			[CardOwner] = @CardOwner,
			[CardNumber] = @CardNumber,
			[CardExpires] = @CardExpires,
			[CardSecurityCode] = @CardSecurityCode,
			[SubTotal] = @SubTotal,
			[TaxTotal] = @TaxTotal,
			[ShippingTotal] = @ShippingTotal,
			[OrderTotal] = @OrderTotal,
			[Completed] = @Completed,
			[CompletedFromIP] = @CompletedFromIP,
			[LastModified] = @LastModified,
			[LastUserActivity] = @LastUserActivity,
			[StatusGuid] = @StatusGuid,
			[GatewayTransID] = @GatewayTransID,
			[GatewayRawResponse] = @GatewayRawResponse,
			[GatewayAuthCode] = @GatewayAuthCode,
			[TaxZoneGuid] = @TaxZoneGuid,
			[PaymentMethod] = @PaymentMethod,
			CustomData = @CustomData,
			DiscountCodesCsv = @DiscountCodesCsv,
			Discount = @Discount,
			ClerkGuid = @ClerkGuid
			
WHERE
			[OrderGuid] = @OrderGuid




' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOfferProduct_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OrderOfferProduct_Delete]

/*
Author:   			Joe Audette
Created: 			3/18/2007
Last Modified: 		3/18/2007
*/

@Guid uniqueidentifier

AS

DELETE FROM [dbo].[ws_OrderOfferProduct]
WHERE
	[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOfferProduct_DeleteByOrder]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OrderOfferProduct_DeleteByOrder]

/*
Author:   			Joe Audette
Created: 			2008-07-18
Last Modified: 		2008-07-18
*/

@OrderGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_OrderOfferProduct]
WHERE
	[OrderGuid] = @OrderGuid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOfferProduct_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OrderOfferProduct_Insert]

/*
Author:   			Joe Audette
Created: 			3/18/2007
Last Modified: 		3/18/2007
*/

@Guid uniqueidentifier,
@OrderGuid uniqueidentifier,
@OfferGuid uniqueidentifier,
@ProductGuid uniqueidentifier,
@FullfillType tinyint,
@FullfillTermsGuid uniqueidentifier,
@Created datetime

	
AS

INSERT INTO 	[dbo].[ws_OrderOfferProduct] 
(
				[Guid],
				[OrderGuid],
				[OfferGuid],
				[ProductGuid],
				[FullfillType],
				[FullfillTermsGuid],
				[Created]
) 

VALUES 
(
				@Guid,
				@OrderGuid,
				@OfferGuid,
				@ProductGuid,
				@FullfillType,
				@FullfillTermsGuid,
				@Created
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOfferProduct_SelectByOrder]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_OrderOfferProduct_SelectByOrder]

/*
Author:   			Joe Audette
Created: 			2007-03-18
Last Modified: 		2009-02-09
*/

@OrderGuid uniqueidentifier

AS


SELECT DISTINCT
		oop.*,
		pd.[Name],
		oo.Quantity,
		oo.OfferPrice
		
FROM
		[dbo].[ws_OrderOfferProduct] oop

LEFT OUTER JOIN
		[dbo].[ws_Product] pd

ON		oop.ProductGuid = pd.Guid

LEFT OUTER JOIN
		[dbo].[ws_OrderOffers] oo

ON	oop.OrderGuid = oo.OrderGuid
AND oop.OfferGuid = oo.OfferGuid
		
WHERE
		oop.[OrderGuid] = @OrderGuid

ORDER BY pd.Name

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOfferProduct_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OrderOfferProduct_SelectOne]

/*
Author:   			Joe Audette
Created: 			3/18/2007
Last Modified: 		3/18/2007
*/

@Guid uniqueidentifier

AS


SELECT
		[Guid],
		[OrderGuid],
		[OfferGuid],
		[ProductGuid],
		[FullfillType],
		[FullfillTermsGuid],
		[Created]
		
FROM
		[dbo].[ws_OrderOfferProduct]
		
WHERE
		[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOfferProduct_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OrderOfferProduct_Update]

/*
Author:   			Joe Audette
Created: 			3/18/2007
Last Modified: 		3/18/2007
*/
	
@Guid uniqueidentifier, 
@OrderGuid uniqueidentifier, 
@OfferGuid uniqueidentifier, 
@ProductGuid uniqueidentifier, 
@FullfillType tinyint, 
@FullfillTermsGuid uniqueidentifier


AS

UPDATE 		[dbo].[ws_OrderOfferProduct] 

SET
			[OrderGuid] = @OrderGuid,
			[OfferGuid] = @OfferGuid,
			[ProductGuid] = @ProductGuid,
			[FullfillType] = @FullfillType,
			[FullfillTermsGuid] = @FullfillTermsGuid
			
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_OrderOffers_Delete]

/*
Author:   			Joe Audette
Created: 			3/17/2007
Last Modified: 		3/17/2007
*/

@ItemGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_OrderOffers]
WHERE
	[ItemGuid] = @ItemGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers_DeleteByOrder]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OrderOffers_DeleteByOrder]

/*
Author:   			Joe Audette
Created: 			2008-07-18
Last Modified: 		2008-07-18
*/

@OrderGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_OrderOffers]
WHERE
	[OrderGuid] = @OrderGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OrderOffers_Insert]

/*
Author:   			Joe Audette
Created: 			2007-03-27
Last Modified: 		2008-10-17
*/

@ItemGuid uniqueidentifier,
@OrderGuid uniqueidentifier,
@OfferGuid uniqueidentifier,
@TaxClassGuid uniqueidentifier,
@OfferPrice decimal(15, 4),
@AddedToCart datetime,
@Quantity int

	
AS

INSERT INTO 	[dbo].[ws_OrderOffers] 
(
				[ItemGuid],
				[OrderGuid],
				[OfferGuid],
				[TaxClassGuid],
				[OfferPrice],
				[AddedToCart],
				[Quantity]
) 

VALUES 
(
				@ItemGuid,
				@OrderGuid,
				@OfferGuid,
				@TaxClassGuid,
				@OfferPrice,
				@AddedToCart,
				@Quantity
				
)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers_SelectByOrder]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OrderOffers_SelectByOrder]

/*
Author:   			Joe Audette
Created: 			2007-03-17
Last Modified: 		2008-10-17
*/

@OrderGuid uniqueidentifier

AS


SELECT
		o.[ItemGuid],
		o.[OrderGuid],
		o.[OfferGuid],
		o.[TaxClassGuid],
		o.[OfferPrice],
		o.[AddedToCart],
		o.[Quantity],
		od.[Name]
			
		
FROM
		[dbo].[ws_OrderOffers] o

LEFT OUTER JOIN
		[dbo].[ws_Offer] od

ON		o.OfferGuid = od.Guid

		
WHERE
		o.[OrderGuid] = @OrderGuid

ORDER BY od.[Name]


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OrderOffers_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-03-17
Last Modified: 		2008-10-17
*/

@ItemGuid uniqueidentifier

AS


SELECT	*
		
FROM
		[dbo].[ws_OrderOffers]
		
WHERE
		[ItemGuid] = @ItemGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_OrderOffers_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_OrderOffers_Update]

/*
Author:   			Joe Audette
Created: 			2007-03-17
Last Modified: 		2008-10-17
*/
	
@ItemGuid uniqueidentifier, 
@OrderGuid uniqueidentifier, 
@OfferGuid uniqueidentifier, 
@TaxClassGuid uniqueidentifier, 
@OfferPrice decimal(15, 4), 
@AddedToCart datetime, 
@Quantity int 


AS

UPDATE 		[dbo].[ws_OrderOffers] 

SET
			[OrderGuid] = @OrderGuid,
			[OfferGuid] = @OfferGuid,
			[TaxClassGuid] = @TaxClassGuid,
			[OfferPrice] = @OfferPrice,
			[AddedToCart] = @AddedToCart,
			[Quantity] = @Quantity
			
WHERE
			[ItemGuid] = @ItemGuid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Product_Delete]

/*
Author:   			Joe Audette
Created: 			2/28/2007
Last Modified: 		2/28/2007
*/
	
@Guid uniqueidentifier, 
@DeletedTime datetime, 
@DeletedBy uniqueidentifier, 
@DeletedFromIP nvarchar(255)



AS
UPDATE 		[dbo].[ws_Product] 

SET
			[IsDeleted] = 1,
			[DeletedTime] = @DeletedTime,
			[DeletedBy] = @DeletedBy,
			[DeletedFromIP] = @DeletedFromIP
			
WHERE
			[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_GetCount]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Product_GetCount]

/*
Author:   			Joe Audette
Created: 			2008-10-16
Last Modified: 		2009-07-28
*/

@StoreGuid uniqueidentifier

AS

SELECT COUNT(*) 
FROM [dbo].[ws_Product] p
WHERE p.[StoreGuid] = @StoreGuid
AND p.[IsDeleted] = 0
		AND p.[ShowInProductList] = 1
		AND p.[Guid] IN (
				SELECT op.ProductGuid 
				FROM [dbo].ws_OfferProduct op
				JOIN [dbo].ws_Offer o
				ON	op.OfferGuid = o.[Guid]
				WHERE op.IsDeleted = 0
				AND o.IsDeleted = 0
				AND o.IsVisible = 1
				)

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_GetCountForAdminList]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Product_GetCountForAdminList]

/*
Author:   			Joe Audette
Created: 			2008-10-26
Last Modified: 		2008-10-26
*/

@StoreGuid uniqueidentifier

AS

SELECT COUNT(*) 
FROM [dbo].[ws_Product] p
WHERE p.[StoreGuid] = @StoreGuid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_GetListForPageOfOffers]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[ws_Product_GetListForPageOfOffers]

-- Author:   			Joe Audette
-- Created: 			2009-07-04
-- Last Modified: 		2009-07-04

@StoreGuid		uniqueidentifier,
@PageNumber 	int,
@PageSize 		int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
[Guid] UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
Guid
)

SELECT
		o.[Guid]
		
FROM
		[dbo].[ws_Offer] o

		
WHERE  o.[StoreGuid] = @StoreGuid
		AND o.[IsDeleted] = 0
		AND o.IsVisible = 1

ORDER BY o.SortRank1, o.SortRank2, o.[Name]

END


SELECT 
p.*,
op.OfferGuid

FROM	ws_Product p

JOIN ws_OfferProduct op
ON p.[Guid] = op.ProductGuid

WHERE 
p.StoreGuid = @StoreGuid
AND p.IsDeleted = 0
AND op.IsDeleted = 0
AND op.OfferGuid IN
(SELECT
		t1.[Guid]
		
FROM
		[dbo].[ws_Offer] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]

WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
)

ORDER BY p.SortRank1, p.SortRank2, p.Name

DROP TABLE #PageIndex



' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Product_Insert]

/*
Author:   			Joe Audette
Created: 			2007-02-24
Last Modified: 		2009-07-01
*/

@Guid uniqueidentifier,
@StoreGuid uniqueidentifier,
@TaxClassGuid uniqueidentifier,
@ModelNumber nvarchar(255),
@Status tinyint,
@FullfillmentType tinyint,
@Weight decimal(7, 2),
@QuantityOnHand int,
@ImageFileName nvarchar(255),
@ImageFileBytes varbinary(max),
@Created datetime,
@CreatedBy uniqueidentifier,
@LastModified datetime,
@LastModifedBy uniqueidentifier,
@Url nvarchar(255),
@Name nvarchar(255),
@Description nvarchar(max),
@Abstract nvarchar(max),
@ShowInProductList bit,
@EnableRating bit,
@MetaDescription nvarchar(255),
@MetaKeywords nvarchar(255),
@SortRank1 int,
@SortRank2 int,
@TeaserFile nvarchar(255),
@TeaserFileLink nvarchar(255)

	
AS

INSERT INTO 	[dbo].[ws_Product] 
(
				[Guid],
				[StoreGuid],
				[TaxClassGuid],
				[ModelNumber],
				[Status],
				[FullfillmentType],
				[Weight],
				[QuantityOnHand],
				[ImageFileName],
				[ImageFileBytes],
				[Created],
				[CreatedBy],
				[LastModified],
				[LastModifedBy],
				[Name],
				[Description],
				[Abstract],
				[ShowInProductList],
				[EnableRating],
				[Url],
				MetaDescription,
				MetaKeywords,
				SortRank1,
				SortRank2,
				TeaserFile,
				TeaserFileLink
) 

VALUES 
(
				@Guid,
				@StoreGuid,
				@TaxClassGuid,
				@ModelNumber,
				@Status,
				@FullfillmentType,
				@Weight,
				@QuantityOnHand,
				@ImageFileName,
				@ImageFileBytes,
				@Created,
				@CreatedBy,
				@LastModified,
				@LastModifedBy,
				@Name,
				@Description,
				@Abstract,
				@ShowInProductList,
				@EnableRating,
				@Url,
				@MetaDescription,
				@MetaKeywords,
				@SortRank1,
				@SortRank2,
				@TeaserFile,
				@TeaserFileLink
				
)


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_SelectAll]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Product_SelectAll]

/*
Author:   			Joe Audette
Created: 			2/24/2007
Last Modified: 		2/24/2007
*/

@StoreGuid uniqueidentifier

AS
SELECT *
		
FROM
		[dbo].[ws_Product] 


WHERE
		[StoreGuid] = @StoreGuid
		AND [IsDeleted] = 0

ORDER BY

[Name]

' 
END
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_SelectByPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Product_SelectByPage]

/*
Author:			Joe Audettte
Created:		2008-12-13
Last Modified:	2009-06-25

*/


@SiteID		int,
@PageID		int

AS
SELECT  	pr.*,
		s.ModuleID,
		m.ModuleTitle,
		m.ViewRoles,
		md.FeatureName

FROM		ws_Product pr

JOIN	ws_Store s
ON s.Guid = pr.StoreGuid

JOIN		mp_Modules m
ON		s.ModuleID = m.ModuleID

JOIN		mp_ModuleDefinitions md
ON		m.ModuleDefID = md.ModuleDefID

JOIN		mp_PageModules pm
ON			pm.ModuleID = m.ModuleID

JOIN		mp_Pages p
ON		p.PageID = pm.PageID

WHERE	p.SiteID = @SiteID
		AND pm.PageID = @PageID
		AND pr.IsDeleted = 0
		AND pr.ShowInProductList = 1

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_SelectForSiteMap]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Product_SelectForSiteMap]

-- Author:   			Joe Audette
-- Created: 			2009-05-13
-- Last Modified: 		2009-05-13

@SiteGuid uniqueidentifier,
@StoreGuid		uniqueidentifier

AS

SELECT
		p.[Guid],
		p.[StoreGuid],
		p.[Url],
		p.[LastModified]
		
		
FROM
		[dbo].[ws_Product] p
		
JOIN
		[dbo].[ws_Store] s
ON
		p.StoreGuid = s.[Guid]
		
WHERE
		s.SiteGuid = @SiteGuid
		AND ((p.StoreGuid = @StoreGuid) OR (@StoreGuid = ''00000000-0000-0000-0000-000000000000''))
		AND p.[IsDeleted] = 0
		AND p.[ShowInProductList] = 1
		AND p.[Guid] IN (
				SELECT op.ProductGuid 
				FROM ws_OfferProduct op
				WHERE op.IsDeleted = 0)

ORDER BY
		p.SortRank1, p.SortRank2, p.[Name]



' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Product_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-02-24
Last Modified: 		2008-10-16
*/

@Guid uniqueidentifier

AS


SELECT	*
		
FROM
		[dbo].[ws_Product] 
	
WHERE
		[Guid] = @Guid

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_SelectPage]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Product_SelectPage]

-- Author:   			Joe Audette
-- Created: 			2007-02-24
-- Last Modified: 		2009-07-28

@StoreGuid		uniqueidentifier,
@PageNumber 	int,
@PageSize 		int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
[Guid]
)

SELECT
		p.[Guid]
		
FROM
		[dbo].[ws_Product] p
		
WHERE
		p.StoreGuid = @StoreGuid
		AND p.[IsDeleted] = 0
		AND p.[ShowInProductList] = 1
		AND p.[Guid] IN (
				SELECT op.ProductGuid 
				FROM [dbo].ws_OfferProduct op
				JOIN [dbo].ws_Offer o
				ON	op.OfferGuid = o.[Guid]
				WHERE op.IsDeleted = 0
				AND o.IsDeleted = 0
				AND o.IsVisible = 1
				)

ORDER BY
		p.SortRank1, p.SortRank2, p.[Name]

END



SELECT
		t1.*
		
FROM
		[dbo].[ws_Product] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]

WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_SelectPageForAdminList]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Product_SelectPageForAdminList]

-- Author:   			Joe Audette
-- Created: 			2008-10-25
-- Last Modified: 		2008-10-25

@StoreGuid		uniqueidentifier,
@PageNumber 	int,
@PageSize 		int

AS
DECLARE @PageLowerBound int
DECLARE @PageUpperBound int


SET @PageLowerBound = (@PageSize * @PageNumber) - @PageSize
SET @PageUpperBound = @PageLowerBound + @PageSize + 1

CREATE TABLE #PageIndex 
(
	IndexID int IDENTITY (1, 1) NOT NULL,
Guid UniqueIdentifier
)

BEGIN

INSERT INTO #PageIndex ( 
Guid
)

SELECT
		p.[Guid]
		
FROM
		[dbo].[ws_Product] p
		
WHERE
		p.StoreGuid = @StoreGuid
		AND p.[IsDeleted] = 0
		

ORDER BY
		p.[Name]

END




SELECT
		t1.*
		
FROM
		[dbo].[ws_Product] t1

JOIN			#PageIndex t2
ON			
		t1.[Guid] = t2.[Guid]

WHERE
		t2.IndexID > @PageLowerBound 
		AND t2.IndexID < @PageUpperBound
		
ORDER BY t2.IndexID

DROP TABLE #PageIndex


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Product_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Product_Update]

/*
Author:   			Joe Audette
Created: 			2007-02-24
Last Modified: 		2009-07-01
*/
	
@Guid uniqueidentifier, 
@TaxClassGuid uniqueidentifier, 
@ModelNumber nvarchar(255), 
@Status tinyint, 
@FullfillmentType tinyint, 
@Weight decimal(7, 2), 
@QuantityOnHand int, 
@ImageFileName nvarchar(255), 
@ImageFileBytes varbinary(max), 
@LastModified datetime, 
@LastModifedBy uniqueidentifier,
@Url nvarchar(255),
@Name nvarchar(255),
@Description nvarchar(max),
@Abstract nvarchar(max),
@ShowInProductList bit,
@EnableRating bit,
@MetaDescription nvarchar(255),
@MetaKeywords nvarchar(255),
@SortRank1 int,
@SortRank2 int,
@TeaserFile nvarchar(255),
@TeaserFileLink nvarchar(255)


AS

UPDATE 		[dbo].[ws_Product] 

SET
			[TaxClassGuid] = @TaxClassGuid,
			[ModelNumber] = @ModelNumber,
			[Status] = @Status,
			[FullfillmentType] = @FullfillmentType,
			[Weight] = @Weight,
			[QuantityOnHand] = @QuantityOnHand,
			[ImageFileName] = @ImageFileName,
			[ImageFileBytes] = @ImageFileBytes,
			[LastModified] = @LastModified,
			[LastModifedBy] = @LastModifedBy,
			[ShowInProductList] = @ShowInProductList,
			[EnableRating] = @EnableRating,
			[Url] = @Url,
			[Name] = @Name,
			[Description] = @Description,
			[Abstract] = @Abstract,
			MetaDescription = @MetaDescription,
			MetaKeywords = @MetaKeywords,
			SortRank1 = @SortRank1,
			SortRank2 = @SortRank2,
			TeaserFile = @TeaserFile,
			TeaserFileLink = @TeaserFileLink
			
WHERE
			[Guid] = @Guid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_ProductFile_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_ProductFile_Delete]

/*
Author:   			Joe Audette
Created: 			2/28/2007
Last Modified: 		2/28/2007
*/

@ProductGuid uniqueidentifier

AS

DELETE FROM [dbo].[ws_ProductFile]
WHERE
	[ProductGuid] = @ProductGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_ProductFile_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_ProductFile_Insert]

/*
Author:   			Joe Audette
Created: 			2/28/2007
Last Modified: 		2/28/2007
*/

@ProductGuid uniqueidentifier,
@FileName nvarchar(255),
@FileImage varbinary(max),
@ServerFileName nvarchar(255),
@ByteLength int,
@Created datetime,
@CreatedBy uniqueidentifier

	
AS

INSERT INTO 	[dbo].[ws_ProductFile] 
(
				[ProductGuid],
				[FileName],
				[FileImage],
				[ServerFileName],
				[ByteLength],
				[Created],
				[CreatedBy]
) 

VALUES 
(
				@ProductGuid,
				@FileName,
				@FileImage,
				@ServerFileName,
				@ByteLength,
				@Created,
				@CreatedBy
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_ProductFile_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_ProductFile_SelectOne]

/*
Author:   			Joe Audette
Created: 			2/28/2007
Last Modified: 		2/28/2007
*/

@ProductGuid uniqueidentifier

AS


SELECT
		[ProductGuid],
		[FileName],
		[FileImage],
		[ServerFileName],
		[ByteLength],
		[Created],
		[CreatedBy]
		
FROM
		[dbo].[ws_ProductFile]
		
WHERE
		[ProductGuid] = @ProductGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_ProductFile_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_ProductFile_Update]

/*
Author:   			Joe Audette
Created: 			2/28/2007
Last Modified: 		2/28/2007
*/
	
@ProductGuid uniqueidentifier, 
@FileName nvarchar(255), 
@FileImage varbinary(max), 
@ServerFileName nvarchar(255), 
@ByteLength int, 
@Created datetime, 
@CreatedBy uniqueidentifier 


AS

UPDATE 		[dbo].[ws_ProductFile] 

SET
			[FileName] = @FileName,
			[FileImage] = @FileImage,
			[ServerFileName] = @ServerFileName,
			[ByteLength] = @ByteLength,
			[Created] = @Created,
			[CreatedBy] = @CreatedBy
			
WHERE
			[ProductGuid] = @ProductGuid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_ProductHistory_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_ProductHistory_Insert]

/*
Author:   			Joe Audette
Created: 			3/5/2007
Last Modified: 		3/5/2007
*/

@Guid uniqueidentifier,
@ProductGuid uniqueidentifier,
@StoreGuid uniqueidentifier,
@TaxClassGuid uniqueidentifier,
@Sku nvarchar(255),
@Status tinyint,
@FullfillmentType tinyint,
@Weight decimal(7, 2),
@QuantityOnHand int,
@ImageFileName nvarchar(255),
@ImageFileBytes varbinary(max),
@Created datetime,
@CreatedBy uniqueidentifier,
@LastModified datetime,
@LastModifedBy uniqueidentifier,
@LogTime datetime

	
AS
INSERT INTO 	[dbo].[ws_ProductHistory] 
(
				[Guid],
				[ProductGuid],
				[StoreGuid],
				[TaxClassGuid],
				[Sku],
				[Status],
				[FullfillmentType],
				[Weight],
				[QuantityOnHand],
				[ImageFileName],
				[ImageFileBytes],
				[Created],
				[CreatedBy],
				[LastModified],
				[LastModifedBy],
				[LogTime]
) 

VALUES 
(
				@Guid,
				@ProductGuid,
				@StoreGuid,
				@TaxClassGuid,
				@Sku,
				@Status,
				@FullfillmentType,
				@Weight,
				@QuantityOnHand,
				@ImageFileName,
				@ImageFileBytes,
				@Created,
				@CreatedBy,
				@LastModified,
				@LastModifedBy,
				@LogTime
				
)
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store_Delete]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ws_Store_Delete]

/*
Author:   			Joe Audette
Created: 			2/19/2007
Last Modified: 		2/19/2007
*/

@Guid uniqueidentifier

AS

DELETE FROM [dbo].[ws_Store]
WHERE
	[Guid] = @Guid
' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store_DeleteByModule]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Store_DeleteByModule]

/*
Author:   			Joe Audette
Created: 			2009-06-23
Last Modified: 		2009-06-23
*/

@ModuleID int

AS

DELETE FROM [dbo].[ws_CartOffers]
WHERE CartGuid IN (SELECT CartGuid 
					FROM [dbo].ws_Cart 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)

DELETE FROM [dbo].[ws_CartOrderInfo]
WHERE CartGuid IN (SELECT CartGuid 
					FROM [dbo].ws_Cart 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)

DELETE FROM [dbo].ws_Cart 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)


DELETE FROM [dbo].ws_FullfillDownloadHistory 
WHERE TicketGuid IN (SELECT [Guid] 
					FROM [dbo].ws_FullfillDownloadTicket 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)


DELETE FROM [dbo].ws_FullfillDownloadTicket 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)

DELETE FROM [dbo].ws_FullfillDownloadTerms
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)

DELETE FROM [dbo].ws_OfferHistory
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)

DELETE FROM [dbo].[ws_OrderOfferProduct]
WHERE OfferGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Offer 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)
					

DELETE FROM [dbo].[ws_OrderOffers]
WHERE OfferGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Offer 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)

DELETE FROM [dbo].ws_Order
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)


DELETE FROM [dbo].[ws_OfferProduct]
WHERE OfferGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Offer 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)
					
DELETE FROM [dbo].[ws_Offer]
WHERE StoreGuid IN (
					SELECT StoreGuid 
					FROM [dbo].[ws_Store]
					WHERE ModuleID = @ModuleID
						)
			

DELETE FROM [dbo].ws_ProductFile 
WHERE ProductGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Product 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)

DELETE FROM [dbo].ws_ProductHistory
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)

DELETE FROM [dbo].mp_FriendlyUrls
WHERE PageGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Product 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)
					)			

DELETE FROM [dbo].ws_Product
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE ModuleID = @ModuleID
										)




DELETE FROM [dbo].[ws_Store]
WHERE ModuleID = @ModuleID



' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store_DeleteBySite]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[ws_Store_DeleteBySite]

/*
Author:   			Joe Audette
Created: 			2008-11-13
Last Modified: 		2009-06-23
*/

@SiteID int

AS

DELETE FROM [dbo].[ws_CartOffers]
WHERE CartGuid IN (SELECT CartGuid 
					FROM [dbo].ws_Cart 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)

DELETE FROM [dbo].[ws_CartOrderInfo]
WHERE CartGuid IN (SELECT CartGuid 
					FROM [dbo].ws_Cart 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)

DELETE FROM [dbo].ws_Cart 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)


DELETE FROM [dbo].ws_FullfillDownloadHistory 
WHERE TicketGuid IN (SELECT [Guid] 
					FROM [dbo].ws_FullfillDownloadTicket 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)


DELETE FROM [dbo].ws_FullfillDownloadTicket 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)

DELETE FROM [dbo].ws_FullfillDownloadTerms
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)

DELETE FROM [dbo].ws_OfferHistory
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)

DELETE FROM [dbo].[ws_OrderOfferProduct]
WHERE OfferGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Offer 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)

DELETE FROM [dbo].[ws_OrderOffers]
WHERE OfferGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Offer 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)

DELETE FROM [dbo].ws_Order
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)


DELETE FROM [dbo].[ws_OfferProduct]
WHERE OfferGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Offer 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)
			
DELETE FROM [dbo].ws_Offer 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
			
DELETE FROM [dbo].ws_ProductFile 
WHERE ProductGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Product 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)

DELETE FROM [dbo].ws_ProductHistory
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
	
										)
DELETE FROM [dbo].mp_FriendlyUrls
WHERE PageGuid IN (SELECT [Guid] 
					FROM [dbo].ws_Product 
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)
					)										

DELETE FROM [dbo].ws_Product
					WHERE StoreGuid IN (
								SELECT StoreGuid 
								FROM [dbo].[ws_Store]
								WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)
										)




DELETE FROM [dbo].[ws_Store]
WHERE SiteGuid IN (SELECT SiteGuid FROM [dbo].mp_Sites WHERE SiteID = @SiteID)



' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store_Insert]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Store_Insert]

/*
Author:   			Joe Audette
Created: 			2007-02-19
Last Modified: 		2009-02-06
*/

@Guid uniqueidentifier,
@SiteGuid uniqueidentifier,
@ModuleID int,
@Name nvarchar(255),
@Description nvarchar(max),
@OwnerName nvarchar(255),
@OwnerEmail nvarchar(100),
@SalesEmail nvarchar(100),
@SupportEmail nvarchar(100),
@EmailFrom nvarchar(100),
@OrderBCCEmail nvarchar(100),
@Phone nvarchar(32),
@Fax nvarchar(32),
@Address nvarchar(255),
@City nvarchar(255),
@ZoneGuid uniqueidentifier,
@PostalCode nvarchar(50),
@CountryGuid uniqueidentifier,
@IsClosed bit,
@ClosedMessage nvarchar(max),
@Created datetime,
@CreatedBy uniqueidentifier

	
AS

INSERT INTO 	[dbo].[ws_Store] 
(
				[Guid],
				[SiteGuid],
				[ModuleID],
				[Name],
				[Description],
				[OwnerName],
				[OwnerEmail],
				[SalesEmail],
				[SupportEmail],
				[EmailFrom],
				[OrderBCCEmail],
				[Phone],
				[Fax],
				[Address],
				[City],
				[ZoneGuid],
				[PostalCode],
				[CountryGuid],
				[IsClosed],
				[ClosedMessage],
				[Created],
				[CreatedBy]
) 

VALUES 
(
				@Guid,
				@SiteGuid,
				@ModuleID,
				@Name,
				@Description,
				@OwnerName,
				@OwnerEmail,
				@SalesEmail,
				@SupportEmail,
				@EmailFrom,
				@OrderBCCEmail,
				@Phone,
				@Fax,
				@Address,
				@City,
				@ZoneGuid,
				@PostalCode,
				@CountryGuid,
				@IsClosed,
				@ClosedMessage,
				@Created,
				@CreatedBy
				
)



' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store_SelectOne]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Store_SelectOne]

/*
Author:   			Joe Audette
Created: 			2007-02-19
Last Modified: 		2009-02-12
*/

@Guid uniqueidentifier

AS


SELECT s.*,
		m.Guid As ModuleGuid
		
FROM
		[dbo].[ws_Store] s

JOIN	[dbo].[mp_Modules] m
ON		m.ModuleID = s.ModuleID
		
WHERE
		s.[Guid] = @Guid


' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store_SelectOneByModuleID]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ws_Store_SelectOneByModuleID]

/*
Author:   			Joe Audette
Created: 			2007-02-19
Last Modified: 		2009-02-12
*/

@ModuleID int

AS


SELECT 
s.*,
m.Guid As ModuleGuid
		
FROM
		[dbo].[ws_Store] s

JOIN	[dbo].[mp_Modules] m
ON		m.ModuleID = s.ModuleID
		
WHERE
		s.[ModuleID] = @ModuleID

' 
END
GO
SET QUOTED_IDENTIFIER ON
GO
--~ StoredProcedure [dbo].[ws_Store_Update] -- Replaced column type ntext with nvarchar(max)
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ws_Store_Update]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ws_Store_Update]

/*
Author:   			Joe Audette
Created: 			2007-02-19
Last Modified: 		2009-02-06
*/
	
@Guid uniqueidentifier, 
@Name nvarchar(255), 
@Description nvarchar(max), 
@OwnerName nvarchar(255), 
@OwnerEmail nvarchar(100), 
@SalesEmail nvarchar(100), 
@SupportEmail nvarchar(100), 
@EmailFrom nvarchar(100), 
@OrderBCCEmail nvarchar(100), 
@Phone nvarchar(32), 
@Fax nvarchar(32), 
@Address nvarchar(255), 
@City nvarchar(255), 
@ZoneGuid uniqueidentifier, 
@PostalCode nvarchar(50), 
@CountryGuid uniqueidentifier, 
@IsClosed bit, 
@ClosedMessage nvarchar(max) 




AS

UPDATE 		[dbo].[ws_Store] 

SET
			
			[Name] = @Name,
			[Description] = @Description,	
			[OwnerName] = @OwnerName,
			[OwnerEmail] = @OwnerEmail,
			[SalesEmail] = @SalesEmail,
			[SupportEmail] = @SupportEmail,
			[EmailFrom] = @EmailFrom,
			[OrderBCCEmail] = @OrderBCCEmail,
			[Phone] = @Phone,
			[Fax] = @Fax,
			[Address] = @Address,
			[City] = @City,
			[ZoneGuid] = @ZoneGuid,
			[PostalCode] = @PostalCode,
			[CountryGuid] = @CountryGuid,
			[IsClosed] = @IsClosed,
			[ClosedMessage] = @ClosedMessage
			
WHERE
			[Guid] = @Guid

' 
END
GO
