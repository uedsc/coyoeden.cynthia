SET ANSI_NULLS OFF
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [dbo].[cy_Groups_Select]


/*
Author:			Joe Audette
Created:		2004-09-12
Last Modified:	2009-12-12

*/

@ModuleID			int,
@UserID				int

AS


SELECT		f.*,
			u.[Name] AS MostRecentPostUser,
			CASE WHEN s.[SubscribeDate] IS NOT NULL and s.[UnSubscribeDate] IS NULL THEN 1
					Else 0
					End AS Subscribed,
			(SELECT COUNT(*) 
				FROM cy_GroupSubscriptions fs 
				WHERE fs.GroupID = f.ItemID AND fs.UnSubscribeDate IS NULL) AS SubscriberCount

FROM			cy_Groups f

LEFT OUTER JOIN	cy_Users u
ON			f.MostRecentPostUserID = u.UserID

LEFT OUTER JOIN cy_GroupSubscriptions s
on			f.ItemID = s.GroupID and s.UserID = @UserID

WHERE		f.ModuleID	= @ModuleID
			AND f.IsActive = 1

ORDER BY		f.SortOrder, f.ItemID

GO


